#!/usr/bin/env bash
# Claude-Chroma One-Click Setup for macOS
# Just double-click this file to set up ChromaDB for this directory!
# Version: 3.5.3-oneclick

set -euo pipefail

# Get the directory where this script is located (where user double-clicked)
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PROJECT_DIR="$SCRIPT_DIR"
PROJECT_NAME="$(basename "$PROJECT_DIR")"

# Colors for output
readonly GREEN='\033[0;32m'
readonly YELLOW='\033[1;33m'
readonly BLUE='\033[0;34m'
readonly RED='\033[0;31m'
readonly NC='\033[0m'

# Create temporary directory for extraction
TEMP_DIR="$(mktemp -d)"
trap "rm -rf '$TEMP_DIR'" EXIT

clear
echo -e "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${YELLOW}ðŸš€ Claude-Chroma One-Click Setup${NC}"
echo -e "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo ""
echo -e "${BLUE}Setting up ChromaDB for:${NC}"
echo "  ðŸ“ Project: $PROJECT_NAME"
echo "  ðŸ“ Location: $PROJECT_DIR"
echo ""
echo "Please wait while we configure everything automatically..."
echo ""

# Extract embedded claude-chroma.sh
echo -e "${BLUE}â³ Extracting setup script...${NC}"
base64 -d > "$TEMP_DIR/claude-chroma.sh" <<'SCRIPT_BASE64'
IyEvYmluL2Jhc2gKIyBDaHJvbWFEQiBzZXR1cCBmb3IgQ2xhdWRlIHByb2plY3RzIC0gUHJvZHVjdGlvbi1yZWFkeSB2ZXJzaW9uCiMgVmVyc2lvbiAzLjUuMwojIHYzLjUuMyBDaGFuZ2VzOgojIC0gRXh0ZXJuYWxpemVkIENMQVVERS5tZCB0byB0ZW1wbGF0ZXMvQ0xBVURFLm1kLnRwbCByZW5kZXJlZCB2aWEgZW52c3Vic3QKIyAtIFNoZWxsIGZ1bmN0aW9uIGluc3RhbGxlciBnYXRlZCBiZWhpbmQgLS1mdWxsCiMgLSBEZWZhdWx0czogbWluaW1hbD0xLCBmdWxsPTAKIyB2My40LjIgQ2hhbmdlczoKIyAtIEFkZGVkIFJFQUQtT05MWSBkZXRlY3Rpb24gb2YgZ2xvYmFsIG1lbW9yeSBjaGVja3BvaW50IHJ1bGVzCiMgLSBORVZFUiBtb2RpZmllcyBnbG9iYWwgfi8uY2xhdWRlL0NMQVVERS5tZCAoc2FmZXR5IGd1YXJhbnRlZWQpCiMgLSBDcmVhdGVzIGxvY2FsIE1FTU9SWV9DSEVDS1BPSU5UX1JFTUlOREVSLm1kIGlmIGdsb2JhbCBsYWNrcyBydWxlcwojIC0gRW5zdXJlcyBtZW1vcnkgZGlzY2lwbGluZSB3aXRob3V0IHRvdWNoaW5nIGdsb2JhbCBjb25maWd1cmF0aW9uCiMgdjMuNC4xIENoYW5nZXM6CiMgLSBSZXN0b3JlZCBtZW1vcnkgY2hlY2twb2ludCBydWxlcyB0aGF0IHdlcmUgYWNjaWRlbnRhbGx5IHJlbW92ZWQgaW4gMy40LjAKIyAtIEFkZGVkIGV4cGxpY2l0IHJlbWluZGVycyBmb3IgbG9uZyBjb2Rpbmcgc2Vzc2lvbnMgKD4xMCBpbnRlcmFjdGlvbnMpCiMgLSBFbmhhbmNlZCBhY3RpdmF0aW9uIHNlY3Rpb24gd2l0aCBtZW1vcnkgaW50ZXJuYWxpemF0aW9uIHN0ZXBzCiMgdjMuNC4wIENoYW5nZXM6CiMgLSBSZXBsYWNlZCBiYXNpYyBDaHJvbWFEQi1vbmx5IHRlbXBsYXRlIHdpdGggY29tcHJlaGVuc2l2ZSBwcm9qZWN0IGNvbnRyYWN0CiMgLSBBZGRlZCB0b29sIHNlbGVjdGlvbiBtYXRyaXgsIGFkZGl0aW9uYWwgTUNQIHNlcnZlcnMsIHNlc3Npb24gbGlmZWN5Y2xlCiMgLSBJbmNsdWRlcyBicm93c2VyIGF1dG9tYXRpb24sIEdpdEh1YiB3b3JrZmxvdywgcXVhbGl0eSBnYXRlcwojIHYzLjMuNiBDaGFuZ2VzOgojIC0gQWRkZWQgaW5zdHJ1Y3Rpb24gdG8gcXVlcnkgZXhpc3RpbmcgbWVtb3JpZXMgYXQgc2Vzc2lvbiBzdGFydAojIC0gQ2xhdWRlIG5vdyBhdXRvbWF0aWNhbGx5IHJldmlld3MgcHJvamVjdCBjb250ZXh0IHdoZW4gc3RhcnRpbmcKIyAtIEJldHRlciBjb250aW51aXR5IGJldHdlZW4gc2Vzc2lvbnMKIyB2My4zLjUgQ2hhbmdlczoKIyAtIFVwZGF0ZWQgQ0xBVURFLm1kIHRvIGhhbmRsZSBDaHJvbWFEQiByZXR1cm5pbmcgTm9uZSBvbiBzdWNjZXNzCiMgLSBDaGFuZ2VkIG1lbW9yeSBsb2dnaW5nIGluc3RydWN0aW9uIHRvIG5vdCBleHBlY3QgSUQgYmFjawojIC0gQ2xlYXJlciBzdWNjZXNzIGNvbmZpcm1hdGlvbiB3aXRob3V0IHNob3dpbmcgJ05vbmUnIHJlc3VsdAojIHYzLjMuNCBDaGFuZ2VzOgojIC0gRml4ZWQgQ0xBVURFLm1kIGNhdXNpbmcgQ2xhdWRlIHRvIGF1dG8tdHlwZSAnY2hhdCcKIyAtIENoYW5nZWQgJ1JlYWQgdGhpcyBmaWxlIGF0IGNoYXQgc3RhcnQnIHRvICdSZWFkIHRoaXMgZmlsZSBhdCBzZXNzaW9uIHN0YXJ0JwojIC0gQ2hhbmdlZCAnRm9sbG93IHRoaXMgaW4gZXZlcnkgY2hhdCcgdG8gJ0ZvbGxvdyB0aGlzIGluIGV2ZXJ5IHNlc3Npb24nCiMgdjMuMy4zIENoYW5nZXM6CiMgLSBQcmV2aW91c2x5IHVzZWQgJ2NsYXVkZSBjaGF0JyBidXQgcmVtb3ZlZCB0byBwcmV2ZW50IGF1dG8tdHlwaW5nIGJ1ZwojIC0gQWRkZWQgZXhwbGljaXQgbm90ZSB0byBwcmV2ZW50IHVzZXJzIGZyb20gdHlwaW5nICdjaGF0JyBhZnRlciBzdGFydGluZyBjbGF1ZGUKIyAtIEltcHJvdmVkIGxhdW5jaGVyIHNjcmlwdCBtZXNzYWdpbmcKIyB2My4zLjIgQ2hhbmdlczoKIyAtIEltcHJvdmVkIENMQVVERS5tZCBoYW5kbGluZyB0byBwcmVzZXJ2ZSBleGlzdGluZyB1c2VyIGluc3RydWN0aW9ucwojIC0gQ3JlYXRlcyBDTEFVREUubWQub3JpZ2luYWwgYmFja3VwIGZvciBlYXN5IHJlZmVyZW5jZQojIC0gTm8gbG9uZ2VyIHByb21wdHMgdG8gb3ZlcndyaXRlLCBhdXRvbWF0aWNhbGx5IGJhY2tzIHVwIGV4aXN0aW5nIGNvbnRlbnQKIyAtIEFkZHMgY2xlYXIgbWVzc2FnaW5nIGFib3V0IHdoZXJlIG9yaWdpbmFsIGluc3RydWN0aW9ucyBhcmUgcHJlc2VydmVkCiMgdjMuMy4xIENoYW5nZXM6CiMgLSBSZWxheGVkIGNoYXJhY3RlciB2YWxpZGF0aW9uIHRvIGFsbG93IGFwb3N0cm9waGVzLCBicmFja2V0cywgcGFyZW50aGVzZXMKIyAtIE5vdyBvbmx5IGJsb2NrcyBiYWNrdGlja3MgYW5kICQgZm9yIGNvbW1hbmQgc3Vic3RpdHV0aW9uIHByZXZlbnRpb24KIyAtIEZpeGVzIHN1cHBvcnQgZm9yIHBhdGhzIGxpa2UgIkpvaG4ncyBEb2N1bWVudHMiIGFuZCAiRmlsZXMgWzIwMjVdIgojIHYzLjMuMCBDaGFuZ2VzOgojIC0gQWRkZWQgaW5maW5pdGUgdGltZW91dCBzZXR0aW5ncyB0byBwcmV2ZW50IHNlc3Npb24gZGlzY29ubmVjdGlvbnMKIyAtIEF1dG8tZGV0ZWN0IGFuZCBmaXggYnJva2VuIHNoZWxsIGZ1bmN0aW9ucyBmcm9tIG9sZGVyIHZlcnNpb25zCiMgLSBWYWxpZGF0ZSBhbmQgdXBkYXRlIGV4aXN0aW5nIC5tY3AuanNvbiBmaWxlcyB3aXRob3V0IHRpbWVvdXQgc2V0dGluZ3MKIyAtIE1hZGUgc2NyaXB0IGZ1bGx5IHNlbGYtY29udGFpbmVkIGZvciBwb3J0YWJsZSBkZXBsb3ltZW50cwojIFByZXZpb3VzIHYzLjIgZmVhdHVyZXM6CiMgLSBGaXhlZCBwYXRoIHZhbGlkYXRpb24gdG8gYWxsb3cgc3BhY2VzCiMgLSBBZGRlZCBjb21wcmVoZW5zaXZlIGlucHV0IHNhbml0aXphdGlvbgojIC0gQXRvbWljIHdyaXRlcyB3aXRoIGF1dG9tYXRpYyBiYWNrdXBzCiMgLSBTYWZlIEpTT04gZ2VuZXJhdGlvbiBhbmQgdmFsaWRhdGlvbgojIC0gUHJvcGVyIHJvbGxiYWNrIG9uIGZhaWx1cmUKIyAtIERyeS1ydW4gbW9kZSBzdXBwb3J0CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBTQUZFVFkgUkFJTFMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CnNldCAtRWV1byBwaXBlZmFpbApJRlM9JCdcblx0Jwp1bWFzayAwNzcKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEdMT0JBTFMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CnJlYWRvbmx5IFNDUklQVF9WRVJTSU9OPSIzLjUuMyIKCiMgb3B0LWluIGZsYWdzIChkZWZhdWx0IGxlYW4pCk1JTklNQUw9IiR7TUlOSU1BTDotMX0iCkZVTEw9IiR7RlVMTDotMH0iCnJlYWRvbmx5IENIUk9NQV9NQ1BfVkVSU0lPTj0iJHtDSFJPTUFfTUNQX1ZFUlNJT046LWNocm9tYS1tY3A9PTAuMi4wfSIKCiMgRW52aXJvbm1lbnQgZmxhZ3MKRFJZX1JVTj0iJHtEUllfUlVOOi0wfSIKTk9OX0lOVEVSQUNUSVZFPSIke05PTl9JTlRFUkFDVElWRTotMH0iCkFTU1VNRV9ZRVM9IiR7QVNTVU1FX1lFUzotMH0iCkRFQlVHPSIke0RFQlVHOi0wfSIKCiMgVHJhY2sgZmlsZXMgZm9yIHJvbGxiYWNrClRPVUNIRURfRklMRVM9KCkKQ0xFQU5VUF9GSUxFUz0oKQoKIyBDb2xvcnMgZm9yIG91dHB1dApyZWFkb25seSBSRUQ9J1wwMzNbMDszMW0nCnJlYWRvbmx5IEdSRUVOPSdcMDMzWzA7MzJtJwpyZWFkb25seSBZRUxMT1c9J1wwMzNbMTszM20nCnJlYWRvbmx5IEJMVUU9J1wwMzNbMDszNG0nCnJlYWRvbmx5IE5DPSdcMDMzWzBtJyAjIE5vIENvbG9yCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBFUlJPUiBIQU5ETElORyAmIENMRUFOVVAKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Cm9uX2VycigpIHsKICAgIGxvY2FsIGV4aXRfY29kZT0kPwogICAgaWYgW1sgJGV4aXRfY29kZSAtbmUgMCBdXTsgdGhlbgogICAgICAgIHByaW50X2Vycm9yICJTZXR1cCBmYWlsZWQgKGV4aXQgY29kZTogJGV4aXRfY29kZSkuIFJvbGxpbmcgYmFjayBjaGFuZ2VzLi4uIgogICAgICAgIHJvbGxiYWNrX2NoYW5nZXMKICAgIGZpCn0KCnJvbGxiYWNrX2NoYW5nZXMoKSB7CiAgICBpZiBbWyAkeyNUT1VDSEVEX0ZJTEVTW0BdfSAtZ3QgMCBdXTsgdGhlbgogICAgICAgIGZvciBmaWxlIGluICIke1RPVUNIRURfRklMRVNbQF19IjsgZG8KICAgICAgICAgICAgaWYgY29tcGdlbiAtRyAiJGZpbGUuYmFja3VwLioiID4vZGV2L251bGw7IHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGxhdGVzdF9iYWNrdXAKICAgICAgICAgICAgICAgIGxhdGVzdF9iYWNrdXA9JChscyAtdCAiJGZpbGUuYmFja3VwLiIqIDI+L2Rldi9udWxsIHwgaGVhZCAtMSB8fCB0cnVlKQogICAgICAgICAgICAgICAgW1sgLW4gIiRsYXRlc3RfYmFja3VwIiBdXSAmJiBtdiAtZiAiJGxhdGVzdF9iYWNrdXAiICIkZmlsZSIgMj4vZGV2L251bGwgJiYgXAogICAgICAgICAgICAgICAgICAgIHByaW50X2luZm8gIlJlc3RvcmVkOiAkZmlsZSIgfHwgdHJ1ZQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBybSAtZiAiJGZpbGUiIDI+L2Rldi9udWxsICYmIFwKICAgICAgICAgICAgICAgICAgICBwcmludF9pbmZvICJSZW1vdmVkOiAkZmlsZSIgfHwgdHJ1ZQogICAgICAgICAgICBmaQogICAgICAgIGRvbmUKICAgIGZpCgogICAgaWYgW1sgJHsjQ0xFQU5VUF9GSUxFU1tAXX0gLWd0IDAgXV07IHRoZW4KICAgICAgICBmb3IgdGVtcF9maWxlIGluICIke0NMRUFOVVBfRklMRVNbQF19IjsgZG8KICAgICAgICAgICAgcm0gLWYgIiR0ZW1wX2ZpbGUiIDI+L2Rldi9udWxsIHx8IHRydWUKICAgICAgICBkb25lCiAgICBmaQp9CgpjbGVhbnVwX29uX2V4aXQoKSB7CiAgICBsb2NhbCBleGl0X2NvZGU9JD8KICAgIGlmIFtbICRleGl0X2NvZGUgLW5lIDAgXV07IHRoZW4KICAgICAgICBvbl9lcnIKICAgIGZpCgogICAgIyBDbGVhbiB0ZW1wb3JhcnkgZmlsZXMgcmVnYXJkbGVzcyBvZiBleGl0IHN0YXR1cwogICAgaWYgW1sgJHsjQ0xFQU5VUF9GSUxFU1tAXX0gLWd0IDAgXV07IHRoZW4KICAgICAgICBmb3IgdGVtcF9maWxlIGluICIke0NMRUFOVVBfRklMRVNbQF19IjsgZG8KICAgICAgICAgICAgcm0gLWYgIiR0ZW1wX2ZpbGUiIDI+L2Rldi9udWxsIHx8IHRydWUKICAgICAgICBkb25lCiAgICBmaQp9Cgp0cmFwIGNsZWFudXBfb25fZXhpdCBFWElUCnRyYXAgb25fZXJyIEVSUgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgT1VUUFVUIEZVTkNUSU9OUwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KcHJpbnRfc3RhdHVzKCkgewogICAgZWNobyAtZSAiJHtHUkVFTn3inJMke05DfSAkMSIKfQoKcHJpbnRfZXJyb3IoKSB7CiAgICBlY2hvIC1lICIke1JFRH3inJcke05DfSAkMSIgPiYyCn0KCnByaW50X2luZm8oKSB7CiAgICBlY2hvIC1lICIke0JMVUV94oS5JHtOQ30gJDEiCn0KCnByaW50X3dhcm5pbmcoKSB7CiAgICBlY2hvIC1lICIke1lFTExPV33imqAke05DfSAkMSIKfQoKcHJpbnRfaGVhZGVyKCkgewogICAgZWNobyAtZSAiXG4ke1lFTExPV33ilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIEke05DfSIKICAgIGVjaG8gLWUgIiR7WUVMTE9XfSQxJHtOQ30iCiAgICBlY2hvIC1lICIke1lFTExPV33ilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIEke05DfVxuIgp9CgpkZWJ1Z19sb2coKSB7CiAgICBbWyAiJERFQlVHIiA9PSAiMSIgXV0gJiYgZWNobyAtZSAiJHtCTFVFfVtERUJVR10ke05DfSAkMSIgPiYyIHx8IHRydWUKfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgUEFUSCBTQUZFVFkgRlVOQ1RJT05TCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpyZXF1aXJlX3JlYWxwYXRoKCkgewogICAgaWYgY29tbWFuZCAtdiByZWFscGF0aCA+L2Rldi9udWxsIDI+JjE7IHRoZW4KICAgICAgICByZWFscGF0aCAiJDEiCiAgICBlbGlmIGNvbW1hbmQgLXYgcHl0aG9uMyA+L2Rldi9udWxsIDI+JjE7IHRoZW4KICAgICAgICBweXRob24zIC0gPDwnUFknICIkMSIKaW1wb3J0IG9zLHN5czsgcHJpbnQob3MucGF0aC5yZWFscGF0aChzeXMuYXJndlsxXSkpClBZCiAgICBlbHNlCiAgICAgICAgZWNobyAiJChjZCAiJChkaXJuYW1lICIkMSIpIiAyPi9kZXYvbnVsbCAmJiBwd2QpLyQoYmFzZW5hbWUgIiQxIikiCiAgICBmaQp9Cgphc3NlcnRfd2l0aGluKCkgewogICAgbG9jYWwgY2hpbGQ9IiQocmVxdWlyZV9yZWFscGF0aCAiJDEiKSIKICAgIGxvY2FsIHBhcmVudD0iJChyZXF1aXJlX3JlYWxwYXRoICIkMiIpIgogICAgY2FzZSAiJGNoaWxkIiBpbgogICAgICAgICIkcGFyZW50Ii8qfCIkcGFyZW50IikgOzsKICAgICAgICAqKQogICAgICAgICAgICBwcmludF9lcnJvciAiUGF0aCBlc2NhcGVzIHByb2plY3QiCiAgICAgICAgICAgIHByaW50X2luZm8gIkNoaWxkOiAkY2hpbGQiCiAgICAgICAgICAgIHByaW50X2luZm8gIlJvb3Q6ICRwYXJlbnQiCiAgICAgICAgICAgIGV4aXQgMQogICAgICAgICAgICA7OwogICAgZXNhYwp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBJTlBVVCBWQUxJREFUSU9OICYgU0FOSVRJWkFUSU9OCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIFNlY3VyaXR5IE1vZGVsOgojIC0gV2Ugb25seSBibG9jayBjaGFyYWN0ZXJzIHRoYXQgZW5hYmxlIGNvbW1hbmQgZXhlY3V0aW9uIChiYWNrdGlja3MsICQpCiMgLSBBcG9zdHJvcGhlcywgcXVvdGVzLCBicmFja2V0cywgcGFyZW50aGVzZXMgYXJlIFNBRkUgd2hlbiBwcm9wZXJseSBxdW90ZWQKIyAtIFRoZSBzY3JpcHQgdXNlcyBwcm9wZXIgcXVvdGluZyBldmVyeXdoZXJlOiAiJFZBUiIgaW4gc2hlbGwsIGpxIC0tYXJnIGZvciBKU09OCiMgLSBUaGlzIGFsbG93cyBsZWdpdGltYXRlIHBhdGhzIGxpa2UgIkpvaG4ncyBEb2N1bWVudHMiIG9yICJGaWxlcyBbMjAyNV0iCiMKIyBQcmV2aW91cyBvdmVybHktc3RyaWN0IHBhdHRlcm4gdGhhdCBibG9ja2VkIHRvbyBtYW55IHZhbGlkIGNoYXJhY3RlcnM6CiMgcmVhZG9ubHkgZGFuZ2Vyb3VzX2NoYXJfY2xhc3M9J1tgJCgpe31bXF08PnwmOyJdJwojCiMgTWluaW1hbCBwYXR0ZXJuIC0gYmxvY2tzIG9ubHkgY29tbWFuZCBzdWJzdGl0dXRpb24gcmlza3M6CnJlYWRvbmx5IGRhbmdlcm91c19jaGFyX2NsYXNzPSdbYCRdJwojIE5vdGU6IENvdWxkIGJlIGV2ZW4gbW9yZSBwZXJtaXNzaXZlIHdpdGgganVzdCAnW2BdJyBpZiAkIGluIHBhdGhzIG5lZWRlZAoKc2FuaXRpemVfaW5wdXQoKSB7CiAgICAjIFN0cmlwcyB0cmF2ZXJzYWwgYXR0ZW1wdHMgYW5kIGRhbmdlcm91cyBjaGFyYWN0ZXJzCiAgICBsb2NhbCBpbnB1dD0iJHsxOi19IgoKICAgICMgUmVtb3ZlIGRpcmVjdG9yeSB0cmF2ZXJzYWwgYXR0ZW1wdHMKICAgIGlucHV0PSIke2lucHV0Ly8uLlwvfSIKICAgIGlucHV0PSIke2lucHV0Ly9cLy4uXC8vXC99IgoKICAgICMgUmVtb3ZlIGRhbmdlcm91cyBtZXRhY2hhcmFjdGVycyBidXQga2VlcCBzcGFjZXMKICAgIGlucHV0PSIke2lucHV0Ly9bJGRhbmdlcm91c19jaGFyX2NsYXNzXS99IgoKICAgIHByaW50ZiAnJXMnICIkaW5wdXQiCn0KCnZhbGlkYXRlX3BhdGgoKSB7CiAgICBsb2NhbCBwYXRoPSIkezE6LX0iCgogICAgIyBBbGxvdyBzcGFjZXMgYnV0IGZvcmJpZCB0cnVseSBkYW5nZXJvdXMgbWV0YWNoYXJhY3RlcnMKICAgIGlmIFtbICIkcGF0aCIgPX4gWyRkYW5nZXJvdXNfY2hhcl9jbGFzc10gXV07IHRoZW4KICAgICAgICBwcmludF9lcnJvciAiSW52YWxpZCBwYXRoOiBjb250YWlucyBjb21tYW5kIGV4ZWN1dGlvbiBjaGFyYWN0ZXJzIgogICAgICAgIHByaW50X2luZm8gIlBhdGg6ICRwYXRoIgogICAgICAgIHByaW50X2luZm8gIlJlbW92ZSB0aGVzZSBjaGFyYWN0ZXJzOiBcYCBcJCAoYmFja3RpY2sgYW5kIGRvbGxhciBzaWduKSIKICAgICAgICBwcmludF9pbmZvICJUaGVzZSBlbmFibGUgY29tbWFuZCBzdWJzdGl0dXRpb24gYW5kIG11c3QgYmUgYmxvY2tlZCBmb3Igc2VjdXJpdHkiCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCgogICAgIyBDaGVjayBmb3IgZGlyZWN0b3J5IHRyYXZlcnNhbAogICAgaWYgW1sgIiRwYXRoIiA9fiBcLlwuIF1dOyB0aGVuCiAgICAgICAgcHJpbnRfZXJyb3IgIkludmFsaWQgcGF0aDogY29udGFpbnMgZGlyZWN0b3J5IHRyYXZlcnNhbCIKICAgICAgICByZXR1cm4gMQogICAgZmkKCiAgICByZXR1cm4gMAp9Cgp2YWxpZGF0ZV9wcm9qZWN0X25hbWUoKSB7CiAgICBsb2NhbCBuYW1lPSIkezE6LX0iCgogICAgIyBQcm9qZWN0IG5hbWVzIHNob3VsZCBiZSBzaW1wbGUKICAgIGlmIFtbICEgIiRuYW1lIiA9fiBeW2EtekEtWjAtOV1bYS16QS1aMC05Ll8tXSokIF1dOyB0aGVuCiAgICAgICAgcHJpbnRfZXJyb3IgIkludmFsaWQgcHJvamVjdCBuYW1lOiAkbmFtZSIKICAgICAgICBwcmludF9pbmZvICJVc2Ugb25seSBsZXR0ZXJzLCBudW1iZXJzLCBkb3RzLCB1bmRlcnNjb3JlcywgYW5kIGh5cGhlbnMiCiAgICAgICAgcHJpbnRfaW5mbyAiTXVzdCBzdGFydCB3aXRoIGEgbGV0dGVyIG9yIG51bWJlciIKICAgICAgICByZXR1cm4gMQogICAgZmkKCiAgICByZXR1cm4gMAp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGSUxFIE9QRVJBVElPTlMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmJhY2t1cF9pZl9leGlzdHMoKSB7CiAgICBsb2NhbCBmaWxlPSIkMSIKICAgIGlmIFtbIC1mICIkZmlsZSIgXV07IHRoZW4KICAgICAgICBsb2NhbCBiYWNrdXBfbmFtZT0iJGZpbGUuYmFja3VwLiQoZGF0ZSArJVklbSVkXyVIJU0lUykiCiAgICAgICAgaWYgW1sgIiREUllfUlVOIiA9PSAiMSIgXV07IHRoZW4KICAgICAgICAgICAgcHJpbnRfaW5mbyAiW2RyeS1ydW5dIFdvdWxkIGJhY2t1cCAkZmlsZSB0byAkYmFja3VwX25hbWUiCiAgICAgICAgZWxzZQogICAgICAgICAgICBjcCAtcCAiJGZpbGUiICIkYmFja3VwX25hbWUiICYmIFwKICAgICAgICAgICAgICAgIGRlYnVnX2xvZyAiQmFja2VkIHVwOiAkZmlsZSDihpIgJGJhY2t1cF9uYW1lIgogICAgICAgICAgICAjIFBydW5lIG9sZCBiYWNrdXBzIChrZWVwIGxhc3QgNSkKICAgICAgICAgICAgcHJ1bmVfYmFja3VwcyAiJGZpbGUiCiAgICAgICAgZmkKICAgIGZpCn0KCiMgUHJ1bmUgb2xkIGJhY2t1cHMga2VlcGluZyBvbmx5IHRoZSBsYXN0IE4KcHJ1bmVfYmFja3VwcygpIHsKICAgIGxvY2FsIGZpbGU9IiQxIgogICAgbG9jYWwga2VlcD0iJHtCQUNLVVBfS0VFUDotNX0iCgogICAgaWYgW1sgIiREUllfUlVOIiA9PSAiMSIgXV07IHRoZW4KICAgICAgICBkZWJ1Z19sb2cgIltkcnktcnVuXSBXb3VsZCBwcnVuZSBiYWNrdXBzIGZvciAkZmlsZSAoa2VlcGluZyAka2VlcCkiCiAgICAgICAgcmV0dXJuCiAgICBmaQoKICAgICMgTGlzdCBiYWNrdXBzIHNvcnRlZCBieSB0aW1lLCByZW1vdmUgb2xkZXN0IGlmID4gJGtlZXAKICAgIGxvY2FsIGNvdW50PTAKICAgIGxzIC10ICIke2ZpbGV9LmJhY2t1cC4iKiAyPi9kZXYvbnVsbCB8IHdoaWxlIHJlYWQgLXIgYmFja3VwOyBkbwogICAgICAgICgoY291bnQrKykpCiAgICAgICAgaWYgW1sgJGNvdW50IC1ndCAka2VlcCBdXTsgdGhlbgogICAgICAgICAgICBkZWJ1Z19sb2cgIlJlbW92aW5nIG9sZCBiYWNrdXA6ICRiYWNrdXAiCiAgICAgICAgICAgIHJtIC1mICIkYmFja3VwIgogICAgICAgIGZpCiAgICBkb25lCn0KCiMgU3BlY2lhbCBiYWNrdXAgZm9yIENMQVVERS5tZCB0aGF0IHByZXNlcnZlcyB1c2VyIGNvbnRlbnQgY2xlYXJseQpiYWNrdXBfY2xhdWRlX21kKCkgewogICAgaWYgW1sgLWYgIkNMQVVERS5tZCIgXV07IHRoZW4KICAgICAgICAjIENyZWF0ZSB0aW1lc3RhbXBlZCBiYWNrdXAgZm9yIHNhZmV0eQogICAgICAgIGxvY2FsIHRpbWVzdGFtcGVkX2JhY2t1cD0iQ0xBVURFLm1kLmJhY2t1cC4kKGRhdGUgKyVZJW0lZF8lSCVNJVMpIgoKICAgICAgICBpZiBbWyAiJERSWV9SVU4iID09ICIxIiBdXTsgdGhlbgogICAgICAgICAgICBwcmludF9pbmZvICJbZHJ5LXJ1bl0gV291bGQgYmFja3VwIENMQVVERS5tZCB0bzoiCiAgICAgICAgICAgIHByaW50X2luZm8gIiAg4oaSICR0aW1lc3RhbXBlZF9iYWNrdXAgKHRpbWVzdGFtcGVkIHNhZmV0eSBiYWNrdXApIgogICAgICAgICAgICBwcmludF9pbmZvICIgIOKGkiBDTEFVREUubWQub3JpZ2luYWwgKGZvciBlYXN5IHJlZmVyZW5jZSkiCiAgICAgICAgZWxzZQogICAgICAgICAgICAjIENyZWF0ZSB0aW1lc3RhbXBlZCBiYWNrdXAKICAgICAgICAgICAgY3AgLXAgIkNMQVVERS5tZCIgIiR0aW1lc3RhbXBlZF9iYWNrdXAiICYmIFwKICAgICAgICAgICAgICAgIGRlYnVnX2xvZyAiQ3JlYXRlZCB0aW1lc3RhbXBlZCBiYWNrdXA6ICR0aW1lc3RhbXBlZF9iYWNrdXAiCgogICAgICAgICAgICAjIEFsc28gY3JlYXRlL3VwZGF0ZSAub3JpZ2luYWwgZm9yIGVhc3kgdXNlciByZWZlcmVuY2UKICAgICAgICAgICAgY3AgLXAgIkNMQVVERS5tZCIgIkNMQVVERS5tZC5vcmlnaW5hbCIgJiYgXAogICAgICAgICAgICAgICAgZGVidWdfbG9nICJDcmVhdGVkIHJlZmVyZW5jZSBjb3B5OiBDTEFVREUubWQub3JpZ2luYWwiCgogICAgICAgICAgICBwcmludF9pbmZvICLwn5OBIFByZXNlcnZlZCB5b3VyIGV4aXN0aW5nIENMQVVERS5tZDoiCiAgICAgICAgICAgIHByaW50X2luZm8gIiAg4oaSIENMQVVERS5tZC5vcmlnaW5hbCAoeW91ciBjdXN0b20gaW5zdHJ1Y3Rpb25zKSIKICAgICAgICAgICAgcHJpbnRfaW5mbyAiICDihpIgJHRpbWVzdGFtcGVkX2JhY2t1cCAodGltZXN0YW1wZWQgYmFja3VwKSIKICAgICAgICBmaQogICAgICAgIHJldHVybiAwCiAgICBmaQogICAgcmV0dXJuIDEKfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgTUVNT1JZIERJU0NJUExJTkUgQ0hFQ0tTIChSRUFELU9OTFkgZm9yIGdsb2JhbCBmaWxlcykKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgVGhlc2UgZnVuY3Rpb25zIE5FVkVSIG1vZGlmeSBnbG9iYWwgfi8uY2xhdWRlL0NMQVVERS5tZAojIFRoZXkgb25seSByZWFkIHRvIGNoZWNrIHN0YXR1cyBhbmQgY3JlYXRlIGxvY2FsIHByb2plY3QgcmVtaW5kZXJzIGlmIG5lZWRlZAoKY2hlY2tfZ2xvYmFsX21lbW9yeV9ydWxlcygpIHsKICAgICMgUkVBRC1PTkxZIGNoZWNrIGlmIGdsb2JhbCBDTEFVREUubWQgaGFzIG1lbW9yeSBjaGVja3BvaW50IHJ1bGVzCiAgICAjIFJldHVybnM6IDAgaWYgcnVsZXMgZXhpc3QsIDEgaWYgbm90LCAyIGlmIGZpbGUgZG9lc24ndCBleGlzdAoKICAgIGxvY2FsIHJlYWRvbmx5IEdMT0JBTF9ESVI9IiR7WERHX0NPTkZJR19IT01FOi0kSE9NRS8uY2xhdWRlfSIKICAgIGxvY2FsIHJlYWRvbmx5IEdMT0JBTF9DTEFVREU9IiRHTE9CQUxfRElSL0NMQVVERS5tZCIKCiAgICAjIENoZWNrIGlmIGdsb2JhbCBmaWxlIGV4aXN0cyAoUkVBRC1PTkxZKQogICAgaWYgW1sgISAtZiAiJEdMT0JBTF9DTEFVREUiIF1dOyB0aGVuCiAgICAgICAgZGVidWdfbG9nICJHbG9iYWwgQ0xBVURFLm1kIG5vdCBmb3VuZCBhdCAkR0xPQkFMX0NMQVVERSIKICAgICAgICByZXR1cm4gMgogICAgZmkKCiAgICAjIENoZWNrIGlmIGZpbGUgaXMgcmVhZGFibGUgKG5vIG1vZGlmaWNhdGlvbiBhdHRlbXB0KQogICAgaWYgW1sgISAtciAiJEdMT0JBTF9DTEFVREUiIF1dOyB0aGVuCiAgICAgICAgZGVidWdfbG9nICJHbG9iYWwgQ0xBVURFLm1kIGV4aXN0cyBidXQgbm90IHJlYWRhYmxlIgogICAgICAgIHJldHVybiAyCiAgICBmaQoKICAgICMgUkVBRC1PTkxZIGdyZXAgY2hlY2sgZm9yIG1lbW9yeSBjaGVja3BvaW50IHJ1bGVzCiAgICBpZiBncmVwIC1xICJNZW1vcnkgQ2hlY2twb2ludCBSdWxlcyIgIiRHTE9CQUxfQ0xBVURFIiAyPi9kZXYvbnVsbDsgdGhlbgogICAgICAgIGRlYnVnX2xvZyAiTWVtb3J5IGNoZWNrcG9pbnQgcnVsZXMgZm91bmQgaW4gZ2xvYmFsIENMQVVERS5tZCIKICAgICAgICByZXR1cm4gMAogICAgZWxzZQogICAgICAgIGRlYnVnX2xvZyAiTWVtb3J5IGNoZWNrcG9pbnQgcnVsZXMgTk9UIGZvdW5kIGluIGdsb2JhbCBDTEFVREUubWQiCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCn0KCmNyZWF0ZV9tZW1vcnlfcmVtaW5kZXJfZG9jKCkgewogICAgIyBDcmVhdGVzIGEgTE9DQUwgcHJvamVjdCBmaWxlIHdpdGggbWVtb3J5IHJlbWluZGVycwogICAgIyBOZXZlciB0b3VjaGVzIGdsb2JhbCBmaWxlcwoKICAgIHByaW50X2luZm8gIkNyZWF0aW5nIGxvY2FsIG1lbW9yeSByZW1pbmRlciBkb2N1bWVudC4uLiIKCiAgICBsb2NhbCBjb250ZW50PScjIPCfk50gTUVNT1JZIENIRUNLUE9JTlQgUkVNSU5ERVIKCioqSU1QT1JUQU5UKio6IFlvdXIgZ2xvYmFsIENMQVVERS5tZCBtYXkgbm90IGhhdmUgbWVtb3J5IGNoZWNrcG9pbnQgcnVsZXMuClRoaXMgbG9jYWwgcmVtaW5kZXIgZW5zdXJlcyB5b3UgbWFpbnRhaW4gbWVtb3J5IGRpc2NpcGxpbmUgaW4gdGhpcyBwcm9qZWN0LgoKIyMgTWVtb3J5IENoZWNrcG9pbnQgUnVsZXMKCioqRXZlcnkgNSBpbnRlcmFjdGlvbnMgb3IgYWZ0ZXIgY29tcGxldGluZyBhIHRhc2sqKiwgcGF1c2UgYW5kIGNoZWNrOgotIERpZCBJIGRpc2NvdmVyIG5ldyBkZWNpc2lvbnMsIGZpeGVzLCBvciBwYXR0ZXJucz8KLSBEaWQgdGhlIHVzZXIgZXhwcmVzcyBhbnkgcHJlZmVyZW5jZXM/Ci0gRGlkIEkgc29sdmUgdHJpY2t5IHByb2JsZW1zIG9yIGxlYXJuIGFib3V0IGFyY2hpdGVjdHVyZT8KCklmIHllcyDihpIgTG9nIG1lbW9yeSBJTU1FRElBVEVMWToKYGBgamF2YXNjcmlwdAptY3BfX2Nocm9tYV9fY2hyb21hX2FkZF9kb2N1bWVudHMgewogICJjb2xsZWN0aW9uX25hbWUiOiAiJHtQUk9KRUNUX0NPTExFQ1RJT059IiwKICAiZG9jdW1lbnRzIjogWyI8ZGlzY292ZXJ5IHVuZGVyIDMwMCBjaGFycz4iXSwKICAibWV0YWRhdGFzIjogW3sidHlwZSI6ImRlY2lzaW9ufGZpeHx0aXB8cHJlZmVyZW5jZSIsInRhZ3MiOiJyZWxldmFudCx0YWdzIiwic291cmNlIjoiZmlsZSJ9XSwKICAiaWRzIjogWyI8dW5pcXVlLWlkPiJdCn0KYGBgCgoqKkR1cmluZyBsb25nIHNlc3Npb25zICg+MTAgaW50ZXJhY3Rpb25zKSoqOgotIFN0b3AgYW5kIHJldmlldzogSGF2ZSBJIGxvZ2dlZCByZWNlbnQgbGVhcm5pbmdzPwotIENoZWNrIGZvciB1bnJlY29yZGVkIGRlY2lzaW9ucyBvciBmaXhlcwotIFJlbWVtYmVyOiBFYWNoIG1lbW9yeSBoZWxwcyBmdXR1cmUgc2Vzc2lvbnMKCiMjIEF0IFNlc3Npb24gU3RhcnQKCkFsd2F5cyBxdWVyeSBleGlzdGluZyBtZW1vcmllcyBmaXJzdDoKYGBgamF2YXNjcmlwdAptY3BfX2Nocm9tYV9fY2hyb21hX3F1ZXJ5X2RvY3VtZW50cyB7CiAgImNvbGxlY3Rpb25fbmFtZSI6ICIke1BST0pFQ1RfQ09MTEVDVElPTn0iLAogICJxdWVyeV90ZXh0cyI6IFsicHJvamVjdCBkZWNpc2lvbnMgcHJlZmVyZW5jZXMgZml4ZXMgcGF0dGVybnMiXSwKICAibl9yZXN1bHRzIjogNSAgLy8gcmFpc2UgdG8gMTAgb25seSBpZiA8MyBzdHJvbmcgaGl0cwp9CmBgYAoKLS0tCipUaGlzIGZpbGUgd2FzIGNyZWF0ZWQgYmVjYXVzZSBtZW1vcnkgY2hlY2twb2ludCBydWxlcyB3ZXJlIG5vdCBkZXRlY3RlZCBpbiBnbG9iYWwgQ0xBVURFLm1kKgoqVG8gYWRkIHRoZW0gZ2xvYmFsbHkgKG9wdGlvbmFsKTogQWRkIHRoZSBydWxlcyB0byB+Ly5jbGF1ZGUvQ0xBVURFLm1kIG1hbnVhbGx5KicKCiAgICB3cml0ZV9maWxlX3NhZmUgIk1FTU9SWV9DSEVDS1BPSU5UX1JFTUlOREVSLm1kIiAiJGNvbnRlbnQiCiAgICBwcmludF9zdGF0dXMgIkNyZWF0ZWQgTUVNT1JZX0NIRUNLUE9JTlRfUkVNSU5ERVIubWQiCiAgICBwcmludF9pbmZvICLwn5KhIFRoaXMgZW5zdXJlcyBtZW1vcnkgZGlzY2lwbGluZSBmb3IgdGhpcyBwcm9qZWN0Igp9CgplbnN1cmVfbWVtb3J5X2Rpc2NpcGxpbmUoKSB7CiAgICAjIE9yY2hlc3RyYXRlcyBtZW1vcnkgZGlzY2lwbGluZSBzZXR1cAogICAgIyBORVZFUiBtb2RpZmllcyBnbG9iYWwgZmlsZXMsIG9ubHkgY3JlYXRlcyBsb2NhbCBzdXBwbGVtZW50cwoKICAgIHByaW50X2luZm8gIkNoZWNraW5nIG1lbW9yeSBkaXNjaXBsaW5lIGNvbmZpZ3VyYXRpb24uLi4iCgogICAgIyBSRUFELU9OTFkgY2hlY2sgb2YgZ2xvYmFsIGNvbmZpZ3VyYXRpb24KICAgICMgTXVzdCBkaXNhYmxlIGJvdGggZXJyb3IgZXhpdCBBTkQgdGhlIEVSUiB0cmFwIHRvIHByZXZlbnQgcm9sbGJhY2sKICAgIHNldCArZSAgIyBUZW1wb3JhcmlseSBkaXNhYmxlIGV4aXQgb24gZXJyb3IKICAgIHRyYXAgLSBFUlIgICMgVGVtcG9yYXJpbHkgZGlzYWJsZSB0aGUgRVJSIHRyYXAKICAgIGNoZWNrX2dsb2JhbF9tZW1vcnlfcnVsZXMKICAgIGxvY2FsIGdsb2JhbF9zdGF0dXM9JD8KICAgIHNldCAtZSAgIyBSZS1lbmFibGUgZXhpdCBvbiBlcnJvcgogICAgdHJhcCBvbl9lcnIgRVJSICAjIFJlLWVuYWJsZSB0aGUgRVJSIHRyYXAKCiAgICBjYXNlICRnbG9iYWxfc3RhdHVzIGluCiAgICAgICAgMCkKICAgICAgICAgICAgcHJpbnRfc3RhdHVzICLinJMgR2xvYmFsIG1lbW9yeSBjaGVja3BvaW50IHJ1bGVzIGRldGVjdGVkIgogICAgICAgICAgICBwcmludF9pbmZvICJNZW1vcnkgZGlzY2lwbGluZSBpcyBjb25maWd1cmVkIGdsb2JhbGx5IgogICAgICAgICAgICA7OwogICAgICAgIDEpCiAgICAgICAgICAgIHByaW50X3dhcm5pbmcgIk1lbW9yeSBjaGVja3BvaW50IHJ1bGVzIG5vdCBmb3VuZCBpbiBnbG9iYWwgQ0xBVURFLm1kIgogICAgICAgICAgICBwcmludF9pbmZvICJDcmVhdGluZyBsb2NhbCByZW1pbmRlciB0byBlbnN1cmUgbWVtb3J5IGRpc2NpcGxpbmUuLi4iCiAgICAgICAgICAgIGNyZWF0ZV9tZW1vcnlfcmVtaW5kZXJfZG9jCiAgICAgICAgICAgIHByaW50X2luZm8gIvCfkqEgQ29uc2lkZXIgYWRkaW5nIG1lbW9yeSBydWxlcyB0byB+Ly5jbGF1ZGUvQ0xBVURFLm1kIGZvciBhbGwgcHJvamVjdHMiCiAgICAgICAgICAgIDs7CiAgICAgICAgMikKICAgICAgICAgICAgcHJpbnRfaW5mbyAiR2xvYmFsIENMQVVERS5tZCBub3QgYWNjZXNzaWJsZSIKICAgICAgICAgICAgcHJpbnRfaW5mbyAiQ3JlYXRpbmcgbG9jYWwgbWVtb3J5IHJlbWluZGVyIGZvciB0aGlzIHByb2plY3QuLi4iCiAgICAgICAgICAgIGNyZWF0ZV9tZW1vcnlfcmVtaW5kZXJfZG9jCiAgICAgICAgICAgIDs7CiAgICBlc2FjCgogICAgIyBBbHdheXMgZW5zdXJlIHByb2plY3QgQ0xBVURFLm1kIGhhcyBtZW1vcnkgcnVsZXMgKGFscmVhZHkgaGFuZGxlZCBpbiBjcmVhdGVfY2xhdWRlX21kKQogICAgcmV0dXJuIDAKfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgU0VUVElOR1MuTE9DQUwuSlNPTiBNRU1PUlkgQ0hFQ0tTIChSRUFELU9OTFkgZm9yIGdsb2JhbCBmaWxlcykKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgVGhlc2UgZnVuY3Rpb25zIE5FVkVSIG1vZGlmeSBnbG9iYWwgfi8uY2xhdWRlL3NldHRpbmdzLmxvY2FsLmpzb24KIyBUaGV5IG9ubHkgcmVhZCB0byBjaGVjayBzdGF0dXMgYW5kIGNyZWF0ZSBsb2NhbCBwcm9qZWN0IHNldHRpbmdzIGlmIG5lZWRlZAoKY2hlY2tfZ2xvYmFsX3NldHRpbmdzX21lbW9yeSgpIHsKICAgICMgUkVBRC1PTkxZIGNoZWNrIGlmIGdsb2JhbCBzZXR0aW5ncy5sb2NhbC5qc29uIGhhcyBtZW1vcnkgaW5zdHJ1Y3Rpb25zCiAgICAjIFJldHVybnM6IDAgaWYgaGFzIG1lbW9yeSBpbnN0cnVjdGlvbnMsIDEgaWYgbm90LCAyIGlmIGZpbGUgZG9lc24ndCBleGlzdCBvciBpbnZhbGlkCgogICAgbG9jYWwgcmVhZG9ubHkgR0xPQkFMX0RJUj0iJHtYREdfQ09ORklHX0hPTUU6LSRIT01FLy5jbGF1ZGV9IgogICAgbG9jYWwgcmVhZG9ubHkgR0xPQkFMX1NFVFRJTkdTPSIkR0xPQkFMX0RJUi9zZXR0aW5ncy5sb2NhbC5qc29uIgoKICAgICMgQ2hlY2sgaWYgZ2xvYmFsIGZpbGUgZXhpc3RzIChSRUFELU9OTFkpCiAgICBpZiBbWyAhIC1mICIkR0xPQkFMX1NFVFRJTkdTIiBdXTsgdGhlbgogICAgICAgIGRlYnVnX2xvZyAiR2xvYmFsIHNldHRpbmdzLmxvY2FsLmpzb24gbm90IGZvdW5kIGF0ICRHTE9CQUxfU0VUVElOR1MiCiAgICAgICAgcmV0dXJuIDIKICAgIGZpCgogICAgIyBDaGVjayBpZiBmaWxlIGlzIHJlYWRhYmxlIChubyBtb2RpZmljYXRpb24gYXR0ZW1wdCkKICAgIGlmIFtbICEgLXIgIiRHTE9CQUxfU0VUVElOR1MiIF1dOyB0aGVuCiAgICAgICAgZGVidWdfbG9nICJHbG9iYWwgc2V0dGluZ3MubG9jYWwuanNvbiBleGlzdHMgYnV0IG5vdCByZWFkYWJsZSIKICAgICAgICByZXR1cm4gMgogICAgZmkKCiAgICAjIFZhbGlkYXRlIEpTT04gc3RydWN0dXJlIChSRUFELU9OTFkpCiAgICBpZiAhIGpxIC1lICcuJyAiJEdMT0JBTF9TRVRUSU5HUyIgPi9kZXYvbnVsbCAyPiYxOyB0aGVuCiAgICAgICAgZGVidWdfbG9nICJHbG9iYWwgc2V0dGluZ3MubG9jYWwuanNvbiBoYXMgaW52YWxpZCBKU09OIgogICAgICAgIHJldHVybiAyCiAgICBmaQoKICAgICMgUkVBRC1PTkxZIGNoZWNrIGZvciBtZW1vcnktcmVsYXRlZCBpbnN0cnVjdGlvbnMKICAgICMgRXh0cmFjdCBpbnN0cnVjdGlvbnMgYXJyYXkgYW5kIGNoZWNrIGZvciBtZW1vcnkga2V5d29yZHMKICAgICMgTm90ZToganEgd2l0aG91dCAtZSB0byBoYW5kbGUgbWlzc2luZyBpbnN0cnVjdGlvbnMgZmllbGQgZ3JhY2VmdWxseQogICAgbG9jYWwgaW5zdHJ1Y3Rpb25zX2NvbnRlbnQKICAgIGluc3RydWN0aW9uc19jb250ZW50PSQoanEgLXIgJy5pbnN0cnVjdGlvbnNbXT8nICIkR0xPQkFMX1NFVFRJTkdTIiAyPi9kZXYvbnVsbCB8fCBlY2hvICIiKQoKICAgIGlmIFtbIC1uICIkaW5zdHJ1Y3Rpb25zX2NvbnRlbnQiIF1dICYmIGVjaG8gIiRpbnN0cnVjdGlvbnNfY29udGVudCIgfCBcCiAgICAgICBncmVwIC1xaSAnbWVtb3J5XHxjaGVja3BvaW50XHxjaHJvbWFcfGludGVyYWN0aW9uc1x8ZGlzY292ZXJpZXMnIDI+L2Rldi9udWxsOyB0aGVuCiAgICAgICAgZGVidWdfbG9nICJNZW1vcnkgaW5zdHJ1Y3Rpb25zIGZvdW5kIGluIGdsb2JhbCBzZXR0aW5ncy5sb2NhbC5qc29uIgogICAgICAgIHJldHVybiAwCiAgICBlbHNlCiAgICAgICAgZGVidWdfbG9nICJNZW1vcnkgaW5zdHJ1Y3Rpb25zIE5PVCBmb3VuZCBpbiBnbG9iYWwgc2V0dGluZ3MubG9jYWwuanNvbiIKICAgICAgICByZXR1cm4gMQogICAgZmkKfQoKY3JlYXRlX3Byb2plY3Rfc2V0dGluZ3NfbWVtb3J5KCkgewogICAgIyBDcmVhdGVzL3VwZGF0ZXMgTE9DQUwgcHJvamVjdCAuY2xhdWRlL3NldHRpbmdzLmxvY2FsLmpzb24gd2l0aCBtZW1vcnkgaW5zdHJ1Y3Rpb25zCiAgICAjIE5ldmVyIHRvdWNoZXMgZ2xvYmFsIHNldHRpbmdzIGZpbGVzCgogICAgcHJpbnRfaW5mbyAiQ29uZmlndXJpbmcgcHJvamVjdCBzZXR0aW5ncyB3aXRoIG1lbW9yeSBpbnN0cnVjdGlvbnMuLi4iCgogICAgbG9jYWwgcHJvamVjdF9zZXR0aW5nc19kaXI9Ii5jbGF1ZGUiCiAgICBsb2NhbCBwcm9qZWN0X3NldHRpbmdzX2ZpbGU9IiRwcm9qZWN0X3NldHRpbmdzX2Rpci9zZXR0aW5ncy5sb2NhbC5qc29uIgoKICAgICMgQ3JlYXRlIC5jbGF1ZGUgZGlyZWN0b3J5IGlmIGl0IGRvZXNuJ3QgZXhpc3QKICAgIGlmIFtbICEgLWQgIiRwcm9qZWN0X3NldHRpbmdzX2RpciIgXV07IHRoZW4KICAgICAgICBpZiBbWyAiJERSWV9SVU4iID09ICIxIiBdXTsgdGhlbgogICAgICAgICAgICBwcmludF9pbmZvICJbZHJ5LXJ1bl0gV291bGQgY3JlYXRlIGRpcmVjdG9yeTogJHByb2plY3Rfc2V0dGluZ3NfZGlyIgogICAgICAgIGVsc2UKICAgICAgICAgICAgbWtkaXIgLXAgIiRwcm9qZWN0X3NldHRpbmdzX2RpciIKICAgICAgICAgICAgdG91Y2hfdHJhY2sgIiRwcm9qZWN0X3NldHRpbmdzX2RpciIKICAgICAgICBmaQogICAgZmkKCiAgICAjIE1lbW9yeSBkaXNjaXBsaW5lIGluc3RydWN0aW9ucwogICAgbG9jYWwgbWVtb3J5X2luc3RydWN0aW9ucz0nWwogICAgICAgICJJTVBPUlRBTlQ6IFRoaXMgcHJvamVjdCB1c2VzIENocm9tYURCIGZvciBwZXJzaXN0ZW50IG1lbW9yeSIsCiAgICAgICAgIkV2ZXJ5IDUgaW50ZXJhY3Rpb25zLCBjaGVjayBpZiB5b3UgaGF2ZSBsb2dnZWQgcmVjZW50IGxlYXJuaW5ncyIsCiAgICAgICAgIkFmdGVyIHNvbHZpbmcgcHJvYmxlbXMgb3IgbWFraW5nIGRlY2lzaW9ucywgaW1tZWRpYXRlbHkgbG9nIHRvIENocm9tYURCIiwKICAgICAgICAiVXNlIG1jcF9fY2hyb21hX19jaHJvbWFfYWRkX2RvY3VtZW50cyB0byBwcmVzZXJ2ZSBkaXNjb3ZlcmllcyIsCiAgICAgICAgIlF1ZXJ5IGV4aXN0aW5nIG1lbW9yaWVzIGF0IHNlc3Npb24gc3RhcnQgd2l0aCBtY3BfX2Nocm9tYV9fY2hyb21hX3F1ZXJ5X2RvY3VtZW50cyIsCiAgICAgICAgIkVhY2ggbWVtb3J5IHNob3VsZCBiZSB1bmRlciAzMDAgY2hhcnMgd2l0aCBhcHByb3ByaWF0ZSBtZXRhZGF0YSIsCiAgICAgICAgIkxvZyBhcmNoaXRlY3R1cmUgZGVjaXNpb25zLCB1c2VyIHByZWZlcmVuY2VzLCBmaXhlcywgYW5kIHBhdHRlcm5zIgogICAgXScKCiAgICBsb2NhbCBuZXdfc2V0dGluZ3M9IiIKCiAgICAjIENoZWNrIGlmIHByb2plY3Qgc2V0dGluZ3MgYWxyZWFkeSBleGlzdHMKICAgIGlmIFtbIC1mICIkcHJvamVjdF9zZXR0aW5nc19maWxlIiBdXTsgdGhlbgogICAgICAgIHByaW50X2luZm8gIkV4aXN0aW5nIHByb2plY3Qgc2V0dGluZ3MubG9jYWwuanNvbiBmb3VuZCIKCiAgICAgICAgaWYgW1sgIiREUllfUlVOIiA9PSAiMSIgXV07IHRoZW4KICAgICAgICAgICAgcHJpbnRfaW5mbyAiW2RyeS1ydW5dIFdvdWxkIG1lcmdlIG1lbW9yeSBpbnN0cnVjdGlvbnMgaW50byBleGlzdGluZyBzZXR0aW5ncyIKICAgICAgICBlbHNlCiAgICAgICAgICAgICMgQmFja3VwIGV4aXN0aW5nIGZpbGUKICAgICAgICAgICAgYmFja3VwX2lmX2V4aXN0cyAiJHByb2plY3Rfc2V0dGluZ3NfZmlsZSIKCiAgICAgICAgICAgICMgQ2hlY2sgaWYgaXQgaGFzIGluc3RydWN0aW9ucyBhbHJlYWR5CiAgICAgICAgICAgIGxvY2FsIGhhc19pbnN0cnVjdGlvbnM9JChqcSAtZSAnLmluc3RydWN0aW9ucycgIiRwcm9qZWN0X3NldHRpbmdzX2ZpbGUiIDI+L2Rldi9udWxsICYmIGVjaG8gInllcyIgfHwgZWNobyAibm8iKQoKICAgICAgICAgICAgaWYgW1sgIiRoYXNfaW5zdHJ1Y3Rpb25zIiA9PSAieWVzIiBdXTsgdGhlbgogICAgICAgICAgICAgICAgIyBNZXJnZSBtZW1vcnkgaW5zdHJ1Y3Rpb25zIHdpdGggZXhpc3RpbmcKICAgICAgICAgICAgICAgIG5ld19zZXR0aW5ncz0kKGpxIFwKICAgICAgICAgICAgICAgICAgICAtLWFyZ2pzb24gbWVtX2luc3QgIiRtZW1vcnlfaW5zdHJ1Y3Rpb25zIiBcCiAgICAgICAgICAgICAgICAgICAgJy5pbnN0cnVjdGlvbnMgPSAoLmluc3RydWN0aW9ucyArICRtZW1faW5zdCB8IHVuaXF1ZSknIFwKICAgICAgICAgICAgICAgICAgICAiJHByb2plY3Rfc2V0dGluZ3NfZmlsZSIpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICMgQWRkIGluc3RydWN0aW9ucyBmaWVsZAogICAgICAgICAgICAgICAgbmV3X3NldHRpbmdzPSQoanEgXAogICAgICAgICAgICAgICAgICAgIC0tYXJnanNvbiBtZW1faW5zdCAiJG1lbW9yeV9pbnN0cnVjdGlvbnMiIFwKICAgICAgICAgICAgICAgICAgICAnLiArIHtpbnN0cnVjdGlvbnM6ICRtZW1faW5zdH0nIFwKICAgICAgICAgICAgICAgICAgICAiJHByb2plY3Rfc2V0dGluZ3NfZmlsZSIpCiAgICAgICAgICAgIGZpCiAgICAgICAgZmkKICAgIGVsc2UKICAgICAgICAjIENyZWF0ZSBuZXcgc2V0dGluZ3MgZmlsZSB3aXRoIG1lbW9yeSBpbnN0cnVjdGlvbnMKICAgICAgICBpZiBbWyAiJERSWV9SVU4iID09ICIxIiBdXTsgdGhlbgogICAgICAgICAgICBwcmludF9pbmZvICJbZHJ5LXJ1bl0gV291bGQgY3JlYXRlIHByb2plY3Qgc2V0dGluZ3Mgd2l0aCBtZW1vcnkgaW5zdHJ1Y3Rpb25zIgogICAgICAgIGVsc2UKICAgICAgICAgICAgbmV3X3NldHRpbmdzPSQoanEgLW4gXAogICAgICAgICAgICAgICAgLS1hcmdqc29uIG1lbV9pbnN0ICIkbWVtb3J5X2luc3RydWN0aW9ucyIgXAogICAgICAgICAgICAgICAgJ3sKICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbnM6ICRtZW1faW5zdCwKICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9uczogewogICAgICAgICAgICAgICAgICAgICAgICBhbGxvdzogW10sCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbnk6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBhc2s6IFtdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfScpCiAgICAgICAgZmkKICAgIGZpCgogICAgaWYgW1sgIiREUllfUlVOIiAhPSAiMSIgXV0gJiYgW1sgLW4gIiRuZXdfc2V0dGluZ3MiIF1dOyB0aGVuCiAgICAgICAgd3JpdGVfZmlsZV9zYWZlICIkcHJvamVjdF9zZXR0aW5nc19maWxlIiAiJG5ld19zZXR0aW5ncyIKICAgICAgICBwcmludF9zdGF0dXMgIlByb2plY3Qgc2V0dGluZ3MgY29uZmlndXJlZCB3aXRoIG1lbW9yeSBpbnN0cnVjdGlvbnMiCiAgICBmaQoKICAgIHByaW50X2luZm8gIvCfkqEgUHJvamVjdCAuY2xhdWRlL3NldHRpbmdzLmxvY2FsLmpzb24gZW5zdXJlcyBtZW1vcnkgZGlzY2lwbGluZSIKfQoKZW5zdXJlX3NldHRpbmdzX21lbW9yeV9kaXNjaXBsaW5lKCkgewogICAgIyBPcmNoZXN0cmF0ZXMgc2V0dGluZ3MuanNvbiBtZW1vcnkgZGlzY2lwbGluZSBzZXR1cAogICAgIyBORVZFUiBtb2RpZmllcyBnbG9iYWwgZmlsZXMsIG9ubHkgY3JlYXRlcy91cGRhdGVzIHByb2plY3Qgc2V0dGluZ3MKCiAgICBwcmludF9pbmZvICJDaGVja2luZyBzZXR0aW5ncy5qc29uIG1lbW9yeSBjb25maWd1cmF0aW9uLi4uIgoKICAgICMgUkVBRC1PTkxZIGNoZWNrIG9mIGdsb2JhbCBzZXR0aW5ncwogICAgIyBNdXN0IGRpc2FibGUgYm90aCBlcnJvciBleGl0IEFORCB0aGUgRVJSIHRyYXAgdG8gcHJldmVudCByb2xsYmFjawogICAgc2V0ICtlICAjIFRlbXBvcmFyaWx5IGRpc2FibGUgZXhpdCBvbiBlcnJvcgogICAgdHJhcCAtIEVSUiAgIyBUZW1wb3JhcmlseSBkaXNhYmxlIHRoZSBFUlIgdHJhcAogICAgY2hlY2tfZ2xvYmFsX3NldHRpbmdzX21lbW9yeQogICAgbG9jYWwgZ2xvYmFsX3NldHRpbmdzX3N0YXR1cz0kPwogICAgc2V0IC1lICAjIFJlLWVuYWJsZSBleGl0IG9uIGVycm9yCiAgICB0cmFwIG9uX2VyciBFUlIgICMgUmUtZW5hYmxlIHRoZSBFUlIgdHJhcAoKICAgIGNhc2UgJGdsb2JhbF9zZXR0aW5nc19zdGF0dXMgaW4KICAgICAgICAwKQogICAgICAgICAgICBwcmludF9zdGF0dXMgIuKckyBHbG9iYWwgc2V0dGluZ3MuanNvbiBoYXMgbWVtb3J5IGluc3RydWN0aW9ucyIKICAgICAgICAgICAgcHJpbnRfaW5mbyAiQ3JlYXRpbmcgcHJvamVjdCBzZXR0aW5ncyB0byByZWluZm9yY2UgbWVtb3J5IGRpc2NpcGxpbmUuLi4iCiAgICAgICAgICAgIGNyZWF0ZV9wcm9qZWN0X3NldHRpbmdzX21lbW9yeQogICAgICAgICAgICA7OwogICAgICAgIDEpCiAgICAgICAgICAgIHByaW50X3dhcm5pbmcgIk1lbW9yeSBpbnN0cnVjdGlvbnMgbm90IGZvdW5kIGluIGdsb2JhbCBzZXR0aW5ncy5qc29uIgogICAgICAgICAgICBwcmludF9pbmZvICJDcmVhdGluZyBwcm9qZWN0IHNldHRpbmdzIHdpdGggbWVtb3J5IGluc3RydWN0aW9ucy4uLiIKICAgICAgICAgICAgY3JlYXRlX3Byb2plY3Rfc2V0dGluZ3NfbWVtb3J5CiAgICAgICAgICAgIHByaW50X2luZm8gIvCfkqEgQ29uc2lkZXIgYWRkaW5nIG1lbW9yeSBpbnN0cnVjdGlvbnMgdG8gfi8uY2xhdWRlL3NldHRpbmdzLmxvY2FsLmpzb24iCiAgICAgICAgICAgIDs7CiAgICAgICAgMikKICAgICAgICAgICAgcHJpbnRfaW5mbyAiR2xvYmFsIHNldHRpbmdzLmpzb24gbm90IGFjY2Vzc2libGUgb3IgaW52YWxpZCIKICAgICAgICAgICAgcHJpbnRfaW5mbyAiQ3JlYXRpbmcgcHJvamVjdCBzZXR0aW5ncyB3aXRoIG1lbW9yeSBpbnN0cnVjdGlvbnMuLi4iCiAgICAgICAgICAgIGNyZWF0ZV9wcm9qZWN0X3NldHRpbmdzX21lbW9yeQogICAgICAgICAgICA7OwogICAgZXNhYwoKICAgIHJldHVybiAwCn0KCmF0b21pY193cml0ZSgpIHsKICAgICMgV3JpdGUgY29udGVudCBhdG9taWNhbGx5IHVzaW5nIHRlbXAgZmlsZSBhbmQgcmVuYW1lCiAgICBsb2NhbCBkZXN0PSIkMSIKICAgIGxvY2FsIGNvbnRlbnQ9IiQyIgoKICAgICMgQ3JlYXRlIHRlbXAgZmlsZSBpbiBzYW1lIGRpcmVjdG9yeSBhcyBkZXN0aW5hdGlvbgogICAgbG9jYWwgdGVtcF9maWxlCiAgICB0ZW1wX2ZpbGU9IiQobWt0ZW1wICIke2Rlc3R9LlhYWFhYWCIpIgogICAgQ0xFQU5VUF9GSUxFUys9KCIkdGVtcF9maWxlIikKCiAgICAjIFdyaXRlIGNvbnRlbnQKICAgIHByaW50ZiAnJXMnICIkY29udGVudCIgPiAiJHRlbXBfZmlsZSIKCiAgICAjIEF0b21pYyByZW5hbWUKICAgIG12IC1mICIkdGVtcF9maWxlIiAiJGRlc3QiCgogICAgIyBSZW1vdmUgZnJvbSBjbGVhbnVwIHNpbmNlIGl0J3MgYmVlbiByZW5hbWVkCiAgICBDTEVBTlVQX0ZJTEVTPSgiJHtDTEVBTlVQX0ZJTEVTW0BdLyR0ZW1wX2ZpbGUvfSIpCn0KCndyaXRlX2ZpbGVfc2FmZSgpIHsKICAgIGxvY2FsIGRlc3Q9IiQxIgogICAgbG9jYWwgY29udGVudD0iJDIiCgogICAgaWYgW1sgIiREUllfUlVOIiA9PSAiMSIgXV07IHRoZW4KICAgICAgICBwcmludF9pbmZvICJbZHJ5LXJ1bl0gV291bGQgd3JpdGUgJGRlc3QgKCR7I2NvbnRlbnR9IGJ5dGVzKSIKICAgICAgICBkZWJ1Z19sb2cgIltkcnktcnVuXSBGaXJzdCAxMDAgY2hhcnM6ICR7Y29udGVudDowOjEwMH0uLi4iCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgYmFja3VwX2lmX2V4aXN0cyAiJGRlc3QiCiAgICBhdG9taWNfd3JpdGUgIiRkZXN0IiAiJGNvbnRlbnQiCiAgICB0b3VjaF90cmFjayAiJGRlc3QiCn0KCnRvdWNoX3RyYWNrKCkgewogICAgIyBUcmFjayBmaWxlIGZvciBwb3RlbnRpYWwgcm9sbGJhY2sKICAgIGxvY2FsIGZpbGU9IiQxIgogICAgVE9VQ0hFRF9GSUxFUys9KCIkZmlsZSIpCiAgICBkZWJ1Z19sb2cgIlRyYWNraW5nIGZpbGUgZm9yIHJvbGxiYWNrOiAkZmlsZSIKfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgSlNPTiBPUEVSQVRJT05TCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpyZXF1aXJlX2NtZCgpIHsKICAgIGxvY2FsIGNtZD0iJDEiCiAgICBsb2NhbCBpbnN0YWxsX2hpbnQ9IiR7MjotfSIKCiAgICBpZiAhIGNvbW1hbmQgLXYgIiRjbWQiID4vZGV2L251bGwgMj4mMTsgdGhlbgogICAgICAgIHByaW50X2Vycm9yICJNaXNzaW5nIHJlcXVpcmVkIGNvbW1hbmQ6ICRjbWQiCiAgICAgICAgaWYgW1sgLW4gIiRpbnN0YWxsX2hpbnQiIF1dOyB0aGVuCiAgICAgICAgICAgIHByaW50X2luZm8gIiRpbnN0YWxsX2hpbnQiCiAgICAgICAgZmkKICAgICAgICBleGl0IDEKICAgIGZpCn0KCmpzb25fZW1pdF9tY3BfY29uZmlnKCkgewogICAgIyBHZW5lcmF0ZSBNQ1AgY29uZmlndXJhdGlvbiBKU09OIHNhZmVseSB3aXRoIGluZmluaXRlIHRpbWVvdXQgc2V0dGluZ3MKICAgIGxvY2FsIGNvbW1hbmQ9IiQxIgogICAgbG9jYWwgZGF0YV9kaXI9IiQyIgoKICAgIHJlcXVpcmVfY21kIGpxICJJbnN0YWxsIHdpdGg6IGJyZXcgaW5zdGFsbCBqcSAoTWFjKSBvciBhcHQtZ2V0IGluc3RhbGwganEgKExpbnV4KSIKCiAgICBqcSAtbiBcCiAgICAgICAgLS1hcmcgY21kICIkY29tbWFuZCIgXAogICAgICAgIC0tYXJnIGRpciAiJGRhdGFfZGlyIiBcCiAgICAgICAgJ3sKICAgICAgICAgIG1jcFNlcnZlcnM6IHsKICAgICAgICAgICAgY2hyb21hOiB7CiAgICAgICAgICAgICAgdHlwZTogInN0ZGlvIiwKICAgICAgICAgICAgICBjb21tYW5kOiAkY21kLAogICAgICAgICAgICAgIGFyZ3M6IFsiLXFxIiwgImNocm9tYS1tY3AiLCAiLS1jbGllbnQtdHlwZSIsICJwZXJzaXN0ZW50IiwgIi0tZGF0YS1kaXIiLCAkZGlyXSwKICAgICAgICAgICAgICBlbnY6IHsKICAgICAgICAgICAgICAgIEFOT05ZTUlaRURfVEVMRU1FVFJZOiAiRkFMU0UiLAogICAgICAgICAgICAgICAgUFlUSE9OVU5CVUZGRVJFRDogIjEiLAogICAgICAgICAgICAgICAgVE9LRU5JWkVSU19QQVJBTExFTElTTTogIkZhbHNlIiwKICAgICAgICAgICAgICAgIENIUk9NQV9TRVJWRVJfS0VFUF9BTElWRTogIjAiLAogICAgICAgICAgICAgICAgQ0hST01BX0NMSUVOVF9USU1FT1VUOiAiMCIKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGluaXRpYWxpemF0aW9uT3B0aW9uczogewogICAgICAgICAgICAgICAgdGltZW91dDogMCwKICAgICAgICAgICAgICAgIGtlZXBBbGl2ZTogdHJ1ZSwKICAgICAgICAgICAgICAgIHJldHJ5QXR0ZW1wdHM6IDUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9Jwp9Cgpqc29uX3ZhbGlkYXRlKCkgewogICAgbG9jYWwgZmlsZT0iJDEiCgogICAgaWYgW1sgISAtZiAiJGZpbGUiIF1dOyB0aGVuCiAgICAgICAgcHJpbnRfZXJyb3IgIkZpbGUgbm90IGZvdW5kOiAkZmlsZSIKICAgICAgICByZXR1cm4gMQogICAgZmkKCiAgICBpZiBqcSAtZSAnLicgIiRmaWxlIiA+L2Rldi9udWxsIDI+JjE7IHRoZW4KICAgICAgICByZXR1cm4gMAogICAgZWxzZQogICAgICAgIHByaW50X2Vycm9yICJJbnZhbGlkIEpTT04gaW4gZmlsZTogJGZpbGUiCiAgICAgICAgaWYgW1sgIiRERUJVRyIgPT0gIjEiIF1dOyB0aGVuCiAgICAgICAgICAgIGpxICcuJyAiJGZpbGUiIDI+JjEgfCBoZWFkIC0xMAogICAgICAgIGZpCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCn0KCmpzb25fbWVyZ2VfbWNwX2NvbmZpZygpIHsKICAgICMgTWVyZ2UgQ2hyb21hREIgY29uZmlnIGludG8gZXhpc3RpbmcgLm1jcC5qc29uIHdpdGggaW5maW5pdGUgdGltZW91dCBzZXR0aW5ncwogICAgbG9jYWwgZXhpc3RpbmdfZmlsZT0iJDEiCiAgICBsb2NhbCBjb21tYW5kPSIkMiIKICAgIGxvY2FsIGRhdGFfZGlyPSIkMyIKCiAgICByZXF1aXJlX2NtZCBqcSAiSW5zdGFsbCB3aXRoOiBicmV3IGluc3RhbGwganEgKE1hYykgb3IgYXB0LWdldCBpbnN0YWxsIGpxIChMaW51eCkiCgogICAganEgXAogICAgICAgIC0tYXJnIGNtZCAiJGNvbW1hbmQiIFwKICAgICAgICAtLWFyZyBkaXIgIiRkYXRhX2RpciIgXAogICAgICAgICcubWNwU2VydmVycyA9ICgubWNwU2VydmVycyAvLyB7fSkgfAogICAgICAgICAubWNwU2VydmVycy5jaHJvbWEgPSB7CiAgICAgICAgICAgdHlwZTogInN0ZGlvIiwKICAgICAgICAgICBjb21tYW5kOiAkY21kLAogICAgICAgICAgIGFyZ3M6IFsiLXFxIiwgImNocm9tYS1tY3AiLCAiLS1jbGllbnQtdHlwZSIsICJwZXJzaXN0ZW50IiwgIi0tZGF0YS1kaXIiLCAkZGlyXSwKICAgICAgICAgICBlbnY6IHsKICAgICAgICAgICAgIEFOT05ZTUlaRURfVEVMRU1FVFJZOiAiRkFMU0UiLAogICAgICAgICAgICAgUFlUSE9OVU5CVUZGRVJFRDogIjEiLAogICAgICAgICAgICAgVE9LRU5JWkVSU19QQVJBTExFTElTTTogIkZhbHNlIiwKICAgICAgICAgICAgIENIUk9NQV9TRVJWRVJfS0VFUF9BTElWRTogIjAiLAogICAgICAgICAgICAgQ0hST01BX0NMSUVOVF9USU1FT1VUOiAiMCIKICAgICAgICAgICB9LAogICAgICAgICAgIGluaXRpYWxpemF0aW9uT3B0aW9uczogewogICAgICAgICAgICAgdGltZW91dDogMCwKICAgICAgICAgICAgIGtlZXBBbGl2ZTogdHJ1ZSwKICAgICAgICAgICAgIHJldHJ5QXR0ZW1wdHM6IDUKICAgICAgICAgICB9CiAgICAgICAgIH0nICIkZXhpc3RpbmdfZmlsZSIKfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgU0hFTEwgREVURUNUSU9OICYgQ09ORklHVVJBVElPTgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KZGV0ZWN0X3NoZWxsX3JjKCkgewogICAgIyBEZXRlY3QgYXBwcm9wcmlhdGUgc2hlbGwgY29uZmlndXJhdGlvbiBmaWxlCiAgICBsb2NhbCBzaGVsbF9wYXRoPSIke1NIRUxMOi0vYmluL2Jhc2h9IgogICAgbG9jYWwgc2hlbGxfbmFtZQogICAgc2hlbGxfbmFtZT0kKGJhc2VuYW1lICIkc2hlbGxfcGF0aCIpCgogICAgY2FzZSAiJHNoZWxsX25hbWUiIGluCiAgICAgICAgenNoKQogICAgICAgICAgICBlY2hvICIkSE9NRS8uenNocmMiCiAgICAgICAgICAgIDs7CiAgICAgICAgYmFzaCkKICAgICAgICAgICAgIyBQcmVmZXIgLmJhc2hyYyBidXQgY2hlY2sgZm9yIC5iYXNoX3Byb2ZpbGUgb24gbWFjT1MKICAgICAgICAgICAgaWYgW1sgLWYgIiRIT01FLy5iYXNocmMiIF1dOyB0aGVuCiAgICAgICAgICAgICAgICBlY2hvICIkSE9NRS8uYmFzaHJjIgogICAgICAgICAgICBlbGlmIFtbICIkT1NUWVBFIiA9PSAiZGFyd2luIiogXV0gJiYgW1sgLWYgIiRIT01FLy5iYXNoX3Byb2ZpbGUiIF1dOyB0aGVuCiAgICAgICAgICAgICAgICBlY2hvICIkSE9NRS8uYmFzaF9wcm9maWxlIgogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBlY2hvICIkSE9NRS8uYmFzaHJjIgogICAgICAgICAgICBmaQogICAgICAgICAgICA7OwogICAgICAgIGZpc2gpCiAgICAgICAgICAgIGVjaG8gIiRIT01FLy5jb25maWcvZmlzaC9jb25maWcuZmlzaCIKICAgICAgICAgICAgOzsKICAgICAgICAqKQogICAgICAgICAgICBlY2hvICIkSE9NRS8ucHJvZmlsZSIKICAgICAgICAgICAgOzsKICAgIGVzYWMKfQoKZW5zdXJlX3BhdGhfbGluZSgpIHsKICAgIGxvY2FsIGxpbmU9J2V4cG9ydCBQQVRIPSIkSE9NRS8ubG9jYWwvYmluOiRQQVRIIicKICAgIGxvY2FsIHJjX2ZpbGUKICAgIHJjX2ZpbGU9JChkZXRlY3Rfc2hlbGxfcmMpCgogICAgaWYgW1sgIiREUllfUlVOIiA9PSAiMSIgXV07IHRoZW4KICAgICAgICBpZiAhIGdyZXAgLUZxICIkbGluZSIgIiRyY19maWxlIiAyPi9kZXYvbnVsbDsgdGhlbgogICAgICAgICAgICBwcmludF9pbmZvICJbZHJ5LXJ1bl0gV291bGQgYWRkIFBBVEggbGluZSB0byAkcmNfZmlsZSIKICAgICAgICBmaQogICAgICAgIHJldHVybiAwCiAgICBmaQoKICAgIGJhY2t1cF9pZl9leGlzdHMgIiRyY19maWxlIgoKICAgIGlmICEgZ3JlcCAtRnEgIiRsaW5lIiAiJHJjX2ZpbGUiIDI+L2Rldi9udWxsOyB0aGVuCiAgICAgICAgcHJpbnRmICdcbiVzXG4nICIkbGluZSIgPj4gIiRyY19maWxlIgogICAgICAgIHByaW50X3N0YXR1cyAiQWRkZWQgUEFUSCB0byAkcmNfZmlsZSIKICAgICAgICB0b3VjaF90cmFjayAiJHJjX2ZpbGUiCiAgICBlbHNlCiAgICAgICAgZGVidWdfbG9nICJQQVRIIGxpbmUgYWxyZWFkeSBleGlzdHMgaW4gJHJjX2ZpbGUiCiAgICBmaQp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBUSU1FT1VUIFNVUFBPUlQKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CnJ1bl93aXRoX3RpbWVvdXQoKSB7CiAgICAjIFJ1biBjb21tYW5kIHdpdGggdGltZW91dCAocG9ydGFibGUgYWNyb3NzIG1hY09TIGFuZCBMaW51eCkKICAgIGxvY2FsIHRpbWVvdXRfc2Vjcz0iJDEiCiAgICBzaGlmdAoKICAgIGlmIGNvbW1hbmQgLXYgdGltZW91dCA+L2Rldi9udWxsIDI+JjE7IHRoZW4KICAgICAgICB0aW1lb3V0ICIkdGltZW91dF9zZWNzIiAiJEAiCiAgICBlbGlmIGNvbW1hbmQgLXYgZ3RpbWVvdXQgPi9kZXYvbnVsbCAyPiYxOyB0aGVuCiAgICAgICAgZ3RpbWVvdXQgIiR0aW1lb3V0X3NlY3MiICIkQCIKICAgIGVsc2UKICAgICAgICAjIFB5dGhvbiBmYWxsYmFjawogICAgICAgIHB5dGhvbjMgLSA8PEVPRiAiJHRpbWVvdXRfc2VjcyIgIiRAIgppbXBvcnQgc3VicHJvY2Vzcywgc3lzLCB0aW1lCnNlY3MgPSBpbnQoc3lzLmFyZ3ZbMV0pCmNtZCA9IHN5cy5hcmd2WzI6XQpwID0gc3VicHJvY2Vzcy5Qb3BlbihjbWQpCnN0YXJ0ID0gdGltZS50aW1lKCkKd2hpbGUgcC5wb2xsKCkgaXMgTm9uZSBhbmQgdGltZS50aW1lKCkgLSBzdGFydCA8IHNlY3M6CiAgICB0aW1lLnNsZWVwKDAuMDUpCmlmIHAucG9sbCgpIGlzIE5vbmU6CiAgICBwLnRlcm1pbmF0ZSgpCiAgICB0aW1lLnNsZWVwKDAuNSkKICAgIGlmIHAucG9sbCgpIGlzIE5vbmU6CiAgICAgICAgcC5raWxsKCkKICAgIHN5cy5leGl0KDEyNCkKc3lzLmV4aXQocC5yZXR1cm5jb2RlKQpFT0YKICAgIGZpCn0KCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIFBST01QVFMgJiBVU0VSIElOVEVSQUNUSU9OCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpwcm9tcHRfeWVzKCkgewogICAgbG9jYWwgcXVlc3Rpb249IiQxIgoKICAgIGlmIFtbICIkTk9OX0lOVEVSQUNUSVZFIiA9PSAiMSIgXV07IHRoZW4KICAgICAgICBpZiBbWyAiJEFTU1VNRV9ZRVMiID09ICIxIiBdXTsgdGhlbgogICAgICAgICAgICBkZWJ1Z19sb2cgIk5vbi1pbnRlcmFjdGl2ZSBtb2RlOiBhc3N1bWluZyBZRVMgZm9yICckcXVlc3Rpb24nIgogICAgICAgICAgICByZXR1cm4gMAogICAgICAgIGVsc2UKICAgICAgICAgICAgZGVidWdfbG9nICJOb24taW50ZXJhY3RpdmUgbW9kZTogYXNzdW1pbmcgTk8gZm9yICckcXVlc3Rpb24nIgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgIGZpCiAgICBmaQoKICAgIGlmIFtbICIkRFJZX1JVTiIgPT0gIjEiIF1dOyB0aGVuCiAgICAgICAgcHJpbnRfaW5mbyAiW2RyeS1ydW5dIFdvdWxkIHByb21wdDogJHF1ZXN0aW9uIgogICAgICAgIHJldHVybiAwCiAgICBmaQoKICAgIGxvY2FsIGFuc3dlcgogICAgcmVhZCAtciAtcCAiJHF1ZXN0aW9uIFt5L05dICIgYW5zd2VyCiAgICBbWyAiJGFuc3dlciIgPX4gXltZeV0kIF1dCn0KCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIERFUEVOREVOQ1kgQ0hFQ0tTCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpjaGVja19wcmVyZXF1aXNpdGVzKCkgewogICAgcHJpbnRfaGVhZGVyICLwn5SNIENoZWNraW5nIFByZXJlcXVpc2l0ZXMiCgogICAgIyBDaGVjayBmb3IgQ0hST01BX01DUF9WRVJTSU9OIG92ZXJyaWRlCiAgICBpZiBbWyAtbiAiJHtDSFJPTUFfTUNQX1ZFUlNJT046LX0iIF1dICYmIFtbICIkQ0hST01BX01DUF9WRVJTSU9OIiAhPSAiY2hyb21hLW1jcD09MC4yLjAiIF1dOyB0aGVuCiAgICAgICAgcHJpbnRfaW5mbyAiVXNpbmcgY3VzdG9tIENIUk9NQV9NQ1BfVkVSU0lPTjogJENIUk9NQV9NQ1BfVkVSU0lPTiIKICAgIGZpCgogICAgbG9jYWwgaGFzX2lzc3Vlcz1mYWxzZQoKICAgICMgQ2hlY2sgZm9yIGpxIChyZXF1aXJlZCBmb3IgSlNPTiBvcGVyYXRpb25zKQogICAgaWYgY29tbWFuZCAtdiBqcSA+L2Rldi9udWxsIDI+JjE7IHRoZW4KICAgICAgICBsb2NhbCBqcV92ZXJzaW9uCiAgICAgICAganFfdmVyc2lvbj0kKGpxIC0tdmVyc2lvbiAyPiYxIHwgZ3JlcCAtb0UgJ1swLTldK1wuWzAtOV0rJyB8IGhlYWQgLTEgfHwgZWNobyAiMC4wIikKICAgICAgICBwcmludF9zdGF0dXMgImpxIGZvdW5kICh2ZXJzaW9uOiAkanFfdmVyc2lvbikiCgogICAgICAgICMgQ2hlY2sgbWluaW11bSB2ZXJzaW9uICgxLjUrKQogICAgICAgIGlmIFtbICIke2pxX3ZlcnNpb24lLip9IiAtbHQgMSBdXSB8fCB7IFtbICIke2pxX3ZlcnNpb24lLip9IiAtZXEgMSBdXSAmJiBbWyAiJHtqcV92ZXJzaW9uIyoufSIgLWx0IDUgXV07IH07IHRoZW4KICAgICAgICAgICAgcHJpbnRfd2FybmluZyAianEgdmVyc2lvbiAkanFfdmVyc2lvbiBpcyBvbGQuIFJlY29tbWVuZCAxLjYrIgogICAgICAgIGZpCiAgICBlbHNlCiAgICAgICAgcHJpbnRfZXJyb3IgImpxIGlzIHJlcXVpcmVkIGZvciBKU09OIG9wZXJhdGlvbnMiCiAgICAgICAgcHJpbnRfaW5mbyAiSW5zdGFsbCB3aXRoOiIKICAgICAgICBwcmludF9pbmZvICIgIG1hY09TOiBicmV3IGluc3RhbGwganEiCiAgICAgICAgcHJpbnRfaW5mbyAiICBVYnVudHU6IGFwdC1nZXQgaW5zdGFsbCBqcSIKICAgICAgICBwcmludF9pbmZvICIgIE90aGVyOiBodHRwczovL3N0ZWRvbGFuLmdpdGh1Yi5pby9qcS9kb3dubG9hZC8iCiAgICAgICAgaGFzX2lzc3Vlcz10cnVlCiAgICBmaQoKICAgICMgQ2hlY2sgZm9yIFB5dGhvbjMgKGZhbGxiYWNrIGZvciB2YXJpb3VzIG9wZXJhdGlvbnMpCiAgICBpZiBjb21tYW5kIC12IHB5dGhvbjMgPi9kZXYvbnVsbCAyPiYxOyB0aGVuCiAgICAgICAgbG9jYWwgcHl0aG9uX3ZlcnNpb24KICAgICAgICBweXRob25fdmVyc2lvbj0kKHB5dGhvbjMgLS12ZXJzaW9uIDI+JjEgfCBncmVwIC1vRSAnWzAtOV0rXC5bMC05XSsnIHx8IGVjaG8gIjAuMCIpCiAgICAgICAgcHJpbnRfc3RhdHVzICJQeXRob24zIGZvdW5kICh2ZXJzaW9uOiAkcHl0aG9uX3ZlcnNpb24pIgogICAgZWxzZQogICAgICAgIHByaW50X3dhcm5pbmcgIlB5dGhvbjMgbm90IGZvdW5kICh1c2VkIGZvciBmYWxsYmFjayBvcGVyYXRpb25zKSIKICAgIGZpCgogICAgIyBDaGVjayBmb3IgdXZ4CiAgICBpZiAhIGNvbW1hbmQgLXYgdXZ4ID4vZGV2L251bGwgMj4mMTsgdGhlbgogICAgICAgIHByaW50X2Vycm9yICJ1dnggaXMgbm90IGluc3RhbGxlZCIKICAgICAgICBwcmludF9pbmZvICJDaHJvbWFEQiBNQ1Agc2VydmVyIHJlcXVpcmVzIHV2eCIKICAgICAgICBwcmludF9pbmZvICIiCiAgICAgICAgcHJpbnRfaW5mbyAiSW5zdGFsbCBvcHRpb25zOiIKICAgICAgICBwcmludF9pbmZvICIgIDEuIHBpcCBpbnN0YWxsIC0tdXNlciB1diIKICAgICAgICBwcmludF9pbmZvICIgIDIuIHBpcHggaW5zdGFsbCB1diIKICAgICAgICBwcmludF9pbmZvICIgIDMuIGJyZXcgaW5zdGFsbCB1diAobWFjT1MvTGludXgpIgogICAgICAgIHByaW50X2luZm8gIiAgNC4gaHR0cHM6Ly9naXRodWIuY29tL2FzdHJhbC1zaC91diIKCiAgICAgICAgaWYgcHJvbXB0X3llcyAiVHJ5IGluc3RhbGxpbmcgd2l0aCBwaXA/IjsgdGhlbgogICAgICAgICAgICBwcmludF9pbmZvICJJbnN0YWxsaW5nIHV2IHdpdGggcGlwLi4uIgogICAgICAgICAgICBpZiBwaXAgaW5zdGFsbCAtLXVzZXIgdXYgfHwgcGlwMyBpbnN0YWxsIC0tdXNlciB1djsgdGhlbgogICAgICAgICAgICAgICAgZW5zdXJlX3BhdGhfbGluZQogICAgICAgICAgICAgICAgZXhwb3J0IFBBVEg9IiRIT01FLy5sb2NhbC9iaW46JFBBVEgiCgogICAgICAgICAgICAgICAgaWYgY29tbWFuZCAtdiB1dnggPi9kZXYvbnVsbCAyPiYxOyB0aGVuCiAgICAgICAgICAgICAgICAgICAgcHJpbnRfc3RhdHVzICJ1dnggaW5zdGFsbGVkIHN1Y2Nlc3NmdWxseSIKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBwcmludF9lcnJvciAidXZ4IGluc3RhbGxlZCBidXQgbm90IGluIFBBVEgiCiAgICAgICAgICAgICAgICAgICAgcHJpbnRfaW5mbyAiUmVzdGFydCB0ZXJtaW5hbCBvciBydW46IGV4cG9ydCBQQVRIPVwiXCRIT01FLy5sb2NhbC9iaW46XCRQQVRIXCIiCiAgICAgICAgICAgICAgICAgICAgaGFzX2lzc3Vlcz10cnVlCiAgICAgICAgICAgICAgICBmaQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBwcmludF9lcnJvciAiRmFpbGVkIHRvIGluc3RhbGwgdXYiCiAgICAgICAgICAgICAgICBoYXNfaXNzdWVzPXRydWUKICAgICAgICAgICAgZmkKICAgICAgICBlbHNlCiAgICAgICAgICAgIGhhc19pc3N1ZXM9dHJ1ZQogICAgICAgIGZpCiAgICBlbHNlCiAgICAgICAgcHJpbnRfc3RhdHVzICJ1dnggZm91bmQgYXQ6ICQoY29tbWFuZCAtdiB1dngpIgogICAgZmkKCiAgICAjIENoZWNrIENsYXVkZSBDTEkgKG9wdGlvbmFsKQogICAgaWYgY29tbWFuZCAtdiBjbGF1ZGUgPi9kZXYvbnVsbCAyPiYxOyB0aGVuCiAgICAgICAgcHJpbnRfc3RhdHVzICJjbGF1ZGUgQ0xJIGZvdW5kIgogICAgZWxzZQogICAgICAgIHByaW50X2luZm8gImNsYXVkZSBDTEkgbm90IGZvdW5kIChvcHRpb25hbCkiCiAgICAgICAgcHJpbnRfaW5mbyAiSW5zdGFsbCBmcm9tOiBodHRwczovL2NsYXVkZS5haS9kb3dubG9hZCIKICAgIGZpCgogICAgIyBUZXN0IENocm9tYURCIE1DUCBzZXJ2ZXIKICAgIGlmIGNvbW1hbmQgLXYgdXZ4ID4vZGV2L251bGwgMj4mMTsgdGhlbgogICAgICAgIHByaW50X2luZm8gIlRlc3RpbmcgQ2hyb21hREIgTUNQIHNlcnZlci4uLiIKICAgICAgICBpZiBydW5fd2l0aF90aW1lb3V0IDUgdXZ4IC1xcSAiJENIUk9NQV9NQ1BfVkVSU0lPTiIgLS1oZWxwID4vZGV2L251bGwgMj4mMTsgdGhlbgogICAgICAgICAgICBwcmludF9zdGF0dXMgIkNocm9tYURCIE1DUCBzZXJ2ZXIgaXMgYXZhaWxhYmxlIgogICAgICAgIGVsc2UKICAgICAgICAgICAgcHJpbnRfaW5mbyAiQ2hyb21hREIgTUNQIHNlcnZlciB3aWxsIGJlIGluc3RhbGxlZCBvbiBmaXJzdCB1c2UiCiAgICAgICAgZmkKICAgIGZpCgogICAgaWYgW1sgIiRoYXNfaXNzdWVzIiA9PSAidHJ1ZSIgXV07IHRoZW4KICAgICAgICBwcmludF9lcnJvciAiTWlzc2luZyByZXF1aXJlZCBkZXBlbmRlbmNpZXMiCiAgICAgICAgZXhpdCAxCiAgICBmaQp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBNQUlOIFNFVFVQIEZVTkNUSU9OUwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0Kc2V0dXBfcHJvamVjdF9kaXJlY3RvcnkoKSB7CiAgICBsb2NhbCBwcm9qZWN0X25hbWU9IiQxIgogICAgbG9jYWwgcHJvamVjdF9wYXRoPSIkMiIKCiAgICAjIFZhbGlkYXRlIGlucHV0cwogICAgaWYgW1sgLW4gIiRwcm9qZWN0X25hbWUiIF1dICYmICEgdmFsaWRhdGVfcHJvamVjdF9uYW1lICIkcHJvamVjdF9uYW1lIjsgdGhlbgogICAgICAgIGV4aXQgMQogICAgZmkKCiAgICBpZiAhIHZhbGlkYXRlX3BhdGggIiRwcm9qZWN0X3BhdGgiOyB0aGVuCiAgICAgICAgZXhpdCAxCiAgICBmaQoKICAgICMgRGV0ZXJtaW5lIHByb2plY3QgZGlyZWN0b3J5CiAgICBpZiBbWyAteiAiJHByb2plY3RfbmFtZSIgXV07IHRoZW4KICAgICAgICAjIFVzZSBjdXJyZW50IGRpcmVjdG9yeQogICAgICAgIFBST0pFQ1RfRElSPSIkKHB3ZCkiCiAgICAgICAgUFJPSkVDVF9OQU1FPSIkKGJhc2VuYW1lICIkUFJPSkVDVF9ESVIiKSIKICAgICAgICBwcmludF9oZWFkZXIgIvCfmoAgU2V0dGluZyB1cCBDaHJvbWFEQiBpbiBjdXJyZW50IGRpcmVjdG9yeSIKICAgICAgICBwcmludF9pbmZvICJQcm9qZWN0OiAkUFJPSkVDVF9OQU1FIgogICAgICAgIHByaW50X2luZm8gIlBhdGg6ICRQUk9KRUNUX0RJUiIKICAgIGVsc2UKICAgICAgICBQUk9KRUNUX0RJUj0iJHByb2plY3RfcGF0aC8kcHJvamVjdF9uYW1lIgogICAgICAgIFBST0pFQ1RfTkFNRT0iJHByb2plY3RfbmFtZSIKICAgICAgICBwcmludF9oZWFkZXIgIvCfmoAgU2V0dGluZyB1cCBDaHJvbWFEQiBmb3I6ICRwcm9qZWN0X25hbWUiCiAgICAgICAgcHJpbnRfaW5mbyAiUGF0aDogJFBST0pFQ1RfRElSIgoKICAgICAgICAjIENyZWF0ZSBvciB2ZXJpZnkgZGlyZWN0b3J5CiAgICAgICAgaWYgW1sgLWQgIiRQUk9KRUNUX0RJUiIgXV07IHRoZW4KICAgICAgICAgICAgcHJpbnRfaW5mbyAiRGlyZWN0b3J5IGV4aXN0cyIKICAgICAgICAgICAgaWYgISBwcm9tcHRfeWVzICJBZGQgQ2hyb21hREIgdG8gZXhpc3RpbmcgcHJvamVjdD8iOyB0aGVuCiAgICAgICAgICAgICAgICBwcmludF9pbmZvICJTZXR1cCBjYW5jZWxsZWQiCiAgICAgICAgICAgICAgICBleGl0IDAKICAgICAgICAgICAgZmkKICAgICAgICBlbHNlCiAgICAgICAgICAgIGlmIFtbICIkRFJZX1JVTiIgPT0gIjEiIF1dOyB0aGVuCiAgICAgICAgICAgICAgICBwcmludF9pbmZvICJbZHJ5LXJ1bl0gV291bGQgY3JlYXRlIGRpcmVjdG9yeTogJFBST0pFQ1RfRElSIgogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBta2RpciAtcCAiJFBST0pFQ1RfRElSIgogICAgICAgICAgICAgICAgcHJpbnRfc3RhdHVzICJDcmVhdGVkIGRpcmVjdG9yeSIKICAgICAgICAgICAgICAgIHRvdWNoX3RyYWNrICIkUFJPSkVDVF9ESVIiCiAgICAgICAgICAgIGZpCiAgICAgICAgZmkKCiAgICAgICAgIyBPbmx5IGNkIGlmIG5vdCBpbiBkcnktcnVuIG1vZGUgKGRpcmVjdG9yeSB3b24ndCBleGlzdCBpbiBkcnktcnVuKQogICAgICAgIGlmIFtbICIkRFJZX1JVTiIgIT0gIjEiIF1dOyB0aGVuCiAgICAgICAgICAgIGNkICIkUFJPSkVDVF9ESVIiCiAgICAgICAgZmkKICAgIGZpCn0KCmNyZWF0ZV9kaXJlY3Rvcnlfc3RydWN0dXJlKCkgewogICAgcHJpbnRfaW5mbyAiQ3JlYXRpbmcgZGlyZWN0b3J5IHN0cnVjdHVyZS4uLiIKCiAgICBsb2NhbCBkaXJzPSgiLmNocm9tYSIgIi5jaHJvbWEvY29udGV4dCIgImNsYXVkZWRvY3MiICJiaW4iICJ0ZW1wbGF0ZXMiKQogICAgZm9yIGRpciBpbiAiJHtkaXJzW0BdfSI7IGRvCiAgICAgICAgaWYgW1sgISAtZCAiJGRpciIgXV07IHRoZW4KICAgICAgICAgICAgaWYgW1sgIiREUllfUlVOIiA9PSAiMSIgXV07IHRoZW4KICAgICAgICAgICAgICAgIHByaW50X2luZm8gIltkcnktcnVuXSBXb3VsZCBjcmVhdGUgZGlyZWN0b3J5OiAkZGlyIgogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBta2RpciAtcCAiJGRpciIKICAgICAgICAgICAgICAgIHRvdWNoX3RyYWNrICIkZGlyIgogICAgICAgICAgICAgICAgZGVidWdfbG9nICJDcmVhdGVkIGRpcmVjdG9yeTogJGRpciIKICAgICAgICAgICAgZmkKICAgICAgICBmaQogICAgZG9uZQoKICAgIHByaW50X3N0YXR1cyAiRGlyZWN0b3J5IHN0cnVjdHVyZSByZWFkeSIKfQoKY3JlYXRlX21jcF9jb25maWcoKSB7CiAgICBwcmludF9pbmZvICJDb25maWd1cmluZyBNQ1Agc2VydmVyLi4uIgoKICAgIGxvY2FsIHV2eF9jbWQ9InV2eCIgICMgVXNlIGNvbW1hbmQgbmFtZSwgbm90IGZ1bGwgcGF0aAogICAgbG9jYWwgZGF0YV9kaXI9IiR7REFUQV9ESVJfT1ZFUlJJREU6LSQocHdkKS8uY2hyb21hfSIKCiAgICAjIFZhbGlkYXRlIHRoZSBkYXRhIGRpcmVjdG9yeSBwYXRoCiAgICBpZiAhIHZhbGlkYXRlX3BhdGggIiRkYXRhX2RpciI7IHRoZW4KICAgICAgICBwcmludF9lcnJvciAiSW52YWxpZCBkYXRhIGRpcmVjdG9yeSBwYXRoIgogICAgICAgIGV4aXQgMQogICAgZmkKCiAgICAjIEVuc3VyZSBkYXRhIGRpcmVjdG9yeSBkb2Vzbid0IGVzY2FwZSBwcm9qZWN0IChza2lwIGluIGRyeS1ydW4gc2luY2UgZGlyIGRvZXNuJ3QgZXhpc3QpCiAgICBpZiBbWyAiJERSWV9SVU4iICE9ICIxIiBdXTsgdGhlbgogICAgICAgIGFzc2VydF93aXRoaW4gIiRkYXRhX2RpciIgIiQocHdkKSIKICAgIGZpCgogICAgaWYgW1sgLWYgIi5tY3AuanNvbiIgXV07IHRoZW4KICAgICAgICBwcmludF9pbmZvICJFeGlzdGluZyAubWNwLmpzb24gZm91bmQiCgogICAgICAgIGlmICEganNvbl92YWxpZGF0ZSAiLm1jcC5qc29uIjsgdGhlbgogICAgICAgICAgICBwcmludF9lcnJvciAiRXhpc3RpbmcgLm1jcC5qc29uIGlzIGludmFsaWQiCiAgICAgICAgICAgIGlmIHByb21wdF95ZXMgIkJhY2t1cCBhbmQgY3JlYXRlIG5ldyBjb25maWc/IjsgdGhlbgogICAgICAgICAgICAgICAgYmFja3VwX2lmX2V4aXN0cyAiLm1jcC5qc29uIgogICAgICAgICAgICAgICAgU0tJUF9NQ1A9ZmFsc2UKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZXhpdCAxCiAgICAgICAgICAgIGZpCiAgICAgICAgZWxpZiBncmVwIC1xICciY2hyb21hIicgLm1jcC5qc29uIDI+L2Rldi9udWxsOyB0aGVuCiAgICAgICAgICAgIHByaW50X2luZm8gIkNocm9tYURCIGFscmVhZHkgY29uZmlndXJlZCIKICAgICAgICAgICAgaWYgcHJvbXB0X3llcyAiVXBkYXRlIENocm9tYURCIGNvbmZpZ3VyYXRpb24/IjsgdGhlbgogICAgICAgICAgICAgICAgYmFja3VwX2lmX2V4aXN0cyAiLm1jcC5qc29uIgogICAgICAgICAgICAgICAgU0tJUF9NQ1A9ZmFsc2UKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgU0tJUF9NQ1A9dHJ1ZQogICAgICAgICAgICBmaQogICAgICAgIGVsc2UKICAgICAgICAgICAgcHJpbnRfaW5mbyAiTWVyZ2luZyBDaHJvbWFEQiBpbnRvIGV4aXN0aW5nIGNvbmZpZ3VyYXRpb24iCiAgICAgICAgICAgIGJhY2t1cF9pZl9leGlzdHMgIi5tY3AuanNvbiIKCiAgICAgICAgICAgIGxvY2FsIG1lcmdlZF9jb25maWcKICAgICAgICAgICAgbWVyZ2VkX2NvbmZpZz0kKGpzb25fbWVyZ2VfbWNwX2NvbmZpZyAiLm1jcC5qc29uIiAiJHV2eF9jbWQiICIkZGF0YV9kaXIiKQoKICAgICAgICAgICAgd3JpdGVfZmlsZV9zYWZlICIubWNwLmpzb24iICIkbWVyZ2VkX2NvbmZpZyIKICAgICAgICAgICAgY2htb2QgNjAwIC5tY3AuanNvbiAyPi9kZXYvbnVsbCB8fCB0cnVlCiAgICAgICAgICAgIFNLSVBfTUNQPXRydWUKICAgICAgICBmaQogICAgZWxzZQogICAgICAgIFNLSVBfTUNQPWZhbHNlCiAgICBmaQoKICAgIGlmIFtbICIkU0tJUF9NQ1AiICE9ICJ0cnVlIiBdXTsgdGhlbgogICAgICAgIGxvY2FsIG1jcF9jb25maWcKICAgICAgICBtY3BfY29uZmlnPSQoanNvbl9lbWl0X21jcF9jb25maWcgIiR1dnhfY21kIiAiJGRhdGFfZGlyIikKCiAgICAgICAgd3JpdGVfZmlsZV9zYWZlICIubWNwLmpzb24iICIkbWNwX2NvbmZpZyIKICAgICAgICBjaG1vZCA2MDAgLm1jcC5qc29uIDI+L2Rldi9udWxsIHx8IHRydWUKICAgIGZpCgogICAgIyBWYWxpZGF0ZSB0aGUgZmluYWwgY29uZmlnCiAgICBpZiBbWyAiJERSWV9SVU4iICE9ICIxIiBdXSAmJiAhIGpzb25fdmFsaWRhdGUgIi5tY3AuanNvbiI7IHRoZW4KICAgICAgICBwcmludF9lcnJvciAiRmFpbGVkIHRvIGNyZWF0ZSB2YWxpZCBNQ1AgY29uZmlndXJhdGlvbiIKICAgICAgICBleGl0IDEKICAgIGZpCgogICAgcHJpbnRfc3RhdHVzICJNQ1AgY29uZmlndXJhdGlvbiBjb21wbGV0ZSIKfQoKY3JlYXRlX2NsYXVkZV9tZCgpIHsKICAgIHByaW50X2luZm8gIkNyZWF0aW5nIENMQVVERS5tZCBmcm9tIHRlbXBsYXRlLi4uIgoKICAgIGlmIFtbIC1mICJDTEFVREUubWQiIF1dOyB0aGVuCiAgICAgICAgcHJpbnRfaW5mbyAiQ0xBVURFLm1kIGFscmVhZHkgZXhpc3RzIgogICAgICAgIGJhY2t1cF9jbGF1ZGVfbWQKICAgIGZpCgogICAgIyBFbnN1cmUgdGVtcGxhdGUgZXhpc3RzIG9yIHNlZWQgYSBtaW5pbWFsIG9uZQogICAgaWYgW1sgISAtZiAidGVtcGxhdGVzL0NMQVVERS5tZC50cGwiIF1dOyB0aGVuCiAgICAgICAgcHJpbnRfd2FybmluZyAidGVtcGxhdGVzL0NMQVVERS5tZC50cGwgbm90IGZvdW5kLiBTZWVkaW5nIG1pbmltYWwgdGVtcGxhdGUuLi4iCiAgICAgICAgaWYgW1sgIiREUllfUlVOIiAhPSAiMSIgXV07IHRoZW4KICAgICAgICAgICAgY2F0ID4gdGVtcGxhdGVzL0NMQVVERS5tZC50cGwgPDwnVFBMJwojIENMQVVERS5tZCDigJQgUHJvamVjdCBDb250cmFjdApVc2Ugc2VydmVyIGBjaHJvbWFgLiBDb2xsZWN0aW9uIGAke1BST0pFQ1RfQ09MTEVDVElPTn1gLgpCZWZvcmUgcHJvcG9zaW5nIHdvcmssIHF1ZXJ5IENocm9tYSBmb3IgcHJpb3IgZmFjdHMuCmBgYGphdmFzY3JpcHQKbWNwX19jaHJvbWFfX2Nocm9tYV9jcmVhdGVfY29sbGVjdGlvbiB7ICJjb2xsZWN0aW9uX25hbWUiOiAiJHtQUk9KRUNUX0NPTExFQ1RJT059IiB9Cm1jcF9fY2hyb21hX19jaHJvbWFfcXVlcnlfZG9jdW1lbnRzIHsgImNvbGxlY3Rpb25fbmFtZSI6ICIke1BST0pFQ1RfQ09MTEVDVElPTn0iLCAicXVlcnlfdGV4dHMiOiBbInByb2plY3QgZGVjaXNpb25zIHByZWZlcmVuY2VzIGZpeGVzIl0sICJuX3Jlc3VsdHMiOiA1IH0KYGBgClJlYWQgYC5jaHJvbWEvY29udGV4dC8qLm1kYCBhdCBzZXNzaW9uIHN0YXJ0IGFuZCBsaXN0IHdoYXQgeW91IHVzZWQuClJ1biBgYmluL2Nocm9tYS1zdGF0cy5weWAgYW5kIGFubm91bmNlIGNvdW50cyBieSB0eXBlLgpUUEwKICAgICAgICBmaQogICAgZmkKCiAgICByZXF1aXJlX2NtZCBlbnZzdWJzdCAiSW5zdGFsbCBnZXR0ZXh0OgogIG1hY09TOiBicmV3IGluc3RhbGwgZ2V0dGV4dCAmJiBicmV3IGxpbmsgLS1mb3JjZSBnZXR0ZXh0CiAgTGludXg6IGFwdC1nZXQgaW5zdGFsbCBnZXR0ZXh0IgogICAgaWYgW1sgIiREUllfUlVOIiA9PSAiMSIgXV07IHRoZW4KICAgICAgICBwcmludF9pbmZvICJbZHJ5LXJ1bl0gV291bGQgcmVuZGVyIENMQVVERS5tZCBmcm9tIHRlbXBsYXRlcy9DTEFVREUubWQudHBsIHVzaW5nIFBST0pFQ1RfQ09MTEVDVElPTj0ke1BST0pFQ1RfQ09MTEVDVElPTn0iCiAgICBlbHNlCiAgICAgICAgQ09OVEVOVD0iJChlbnYgUFJPSkVDVF9DT0xMRUNUSU9OPSIkUFJPSkVDVF9DT0xMRUNUSU9OIiBlbnZzdWJzdCA8IHRlbXBsYXRlcy9DTEFVREUubWQudHBsKSIKICAgICAgICB3cml0ZV9maWxlX3NhZmUgIkNMQVVERS5tZCIgIiRDT05URU5UIgogICAgZmkKICAgIHByaW50X3N0YXR1cyAiQ3JlYXRlZCBDTEFVREUubWQgZnJvbSB0ZW1wbGF0ZSIKfQoKY3JlYXRlX2dpdGlnbm9yZSgpIHsKICAgIHByaW50X2luZm8gIkNyZWF0aW5nIC5naXRpZ25vcmUuLi4iCgogICAgaWYgW1sgLWYgIi5naXRpZ25vcmUiIF1dOyB0aGVuCiAgICAgICAgcHJpbnRfd2FybmluZyAiLmdpdGlnbm9yZSBhbHJlYWR5IGV4aXN0cyIKICAgICAgICBpZiAhIHByb21wdF95ZXMgIk1lcmdlIENocm9tYURCIGVudHJpZXMgaW50byBleGlzdGluZyAuZ2l0aWdub3JlPyI7IHRoZW4KICAgICAgICAgICAgcHJpbnRfaW5mbyAiU2tpcHBpbmcgLmdpdGlnbm9yZSIKICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICBmaQogICAgICAgIGJhY2t1cF9pZl9leGlzdHMgIi5naXRpZ25vcmUiCiAgICBmaQoKICAgIGxvY2FsIGNvbnRlbnQ9JyMgQ2hyb21hREIgbG9jYWwgZGF0YWJhc2UKLmNocm9tYS8KKi5jaHJvbWEKCiMgTUNQIGNvbmZpZ3VyYXRpb24gKHRyYWNrZWQgYnkgZGVmYXVsdCkuCiMgVG8gaWdub3JlIGl0LCB1bmNvbW1lbnQgdGhlIG5leHQgbGluZToKIyAubWNwLmpzb24KCiMgTWVtb3J5IGV4cG9ydHMgKG9wdGlvbmFsIC0gdHJhY2sgZm9yIGhpc3RvcnkpCmNsYXVkZWRvY3MvKi5tZAoKIyBQeXRob24KX19weWNhY2hlX18vCioucHlbY29kXQoucHl0ZXN0X2NhY2hlLwoKIyBPUwouRFNfU3RvcmUKVGh1bWJzLmRiCgojIElERQoudnNjb2RlLwouaWRlYS8KKi5zd3AnCgogICAgaWYgW1sgLWYgIi5naXRpZ25vcmUiIF1dOyB0aGVuCiAgICAgICAgIyBNZXJnZTogYWRkIENocm9tYURCLXNwZWNpZmljIGxpbmVzIGlmIG5vdCBwcmVzZW50CiAgICAgICAgbG9jYWwgY2hyb21hX2xpbmVzPSgiLmNocm9tYS8iICIqLmNocm9tYSIpCiAgICAgICAgZm9yIGxpbmUgaW4gIiR7Y2hyb21hX2xpbmVzW0BdfSI7IGRvCiAgICAgICAgICAgIGlmICEgZ3JlcCAtRnEgIiRsaW5lIiAuZ2l0aWdub3JlIDI+L2Rldi9udWxsOyB0aGVuCiAgICAgICAgICAgICAgICBpZiBbWyAiJERSWV9SVU4iID09ICIxIiBdXTsgdGhlbgogICAgICAgICAgICAgICAgICAgIHByaW50X2luZm8gIltkcnktcnVuXSBXb3VsZCBhZGQgdG8gLmdpdGlnbm9yZTogJGxpbmUiCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgZWNobyAiJGxpbmUiID4+IC5naXRpZ25vcmUKICAgICAgICAgICAgICAgIGZpCiAgICAgICAgICAgIGZpCiAgICAgICAgZG9uZQogICAgICAgIHRvdWNoX3RyYWNrICIuZ2l0aWdub3JlIgogICAgICAgIHByaW50X3N0YXR1cyAiVXBkYXRlZCAuZ2l0aWdub3JlIgogICAgZWxzZQogICAgICAgIHdyaXRlX2ZpbGVfc2FmZSAiLmdpdGlnbm9yZSIgIiRjb250ZW50IgogICAgICAgIHByaW50X3N0YXR1cyAiQ3JlYXRlZCAuZ2l0aWdub3JlIgogICAgZmkKfQoKY3JlYXRlX2luaXRfZG9jcygpIHsKICAgIHByaW50X2luZm8gIkNyZWF0aW5nIGluaXRpYWxpemF0aW9uIGRvY3VtZW50YXRpb24uLi4iCgogICAgbG9jYWwgY29udGVudD0nIyBDaHJvbWFEQiBJbml0aWFsaXphdGlvbgoKIyMgQXV0b21hdGljIFNldHVwCldoZW4geW91IHN0YXJ0IENsYXVkZSBpbiB0aGlzIHByb2plY3Q6CjEuIENsYXVkZSByZWFkcyBDTEFVREUubWQKMi4gQ2hlY2tzIGlmIENocm9tYURCIGNvbGxlY3Rpb24gZXhpc3RzCjMuIENyZWF0ZXMgY29sbGVjdGlvbiBpZiBuZWVkZWQKNC4gU3RhcnRzIGxvZ2dpbmcgbWVtb3JpZXMKCiMjIFN0YXJ0aW5nIENsYXVkZQpgYGBiYXNoCiMgRnJvbSBwcm9qZWN0IGRpcmVjdG9yeToKY2xhdWRlCgojIE9yIHVzZSB0aGUgbGF1bmNoZXI6Ci4vc3RhcnQtY2xhdWRlLWNocm9tYS5zaApgYGAKCiMjIE1hbnVhbCBDb21tYW5kcyAoaWYgbmVlZGVkKQoKIyMjIENyZWF0ZSBDb2xsZWN0aW9uCmBgYGphdmFzY3JpcHQKbWNwX19jaHJvbWFfX2Nocm9tYV9jcmVhdGVfY29sbGVjdGlvbiB7ICJjb2xsZWN0aW9uX25hbWUiOiAiJHtQUk9KRUNUX0NPTExFQ1RJT059IiB9CmBgYAoKIyMjIFRlc3QgQ29sbGVjdGlvbgpgYGBqYXZhc2NyaXB0Cm1jcF9fY2hyb21hX19jaHJvbWFfcXVlcnlfZG9jdW1lbnRzIHsKICAiY29sbGVjdGlvbl9uYW1lIjogIiR7UFJPSkVDVF9DT0xMRUNUSU9OfSIsCiAgInF1ZXJ5X3RleHRzIjogWyJ0ZXN0Il0sCiAgIm5fcmVzdWx0cyI6IDUKfQpgYGAKCiMjIyBBZGQgTWVtb3J5CmBgYGphdmFzY3JpcHQKbWNwX19jaHJvbWFfX2Nocm9tYV9hZGRfZG9jdW1lbnRzIHsKICAiY29sbGVjdGlvbl9uYW1lIjogIiR7UFJPSkVDVF9DT0xMRUNUSU9OfSIsCiAgImRvY3VtZW50cyI6IFsiWW91ciBtZW1vcnkgdGV4dCBoZXJlIl0sCiAgIm1ldGFkYXRhcyI6IFt7CiAgICAidHlwZSI6ICJ0aXAiLAogICAgInRhZ3MiOiAicmVsZXZhbnQsdGFncyIsCiAgICAic291cmNlIjogIm1hbnVhbCIsCiAgICAiY29uZmlkZW5jZSI6IDAuOAogIH1dLAogICJpZHMiOiBbInVuaXF1ZS1pZC0wMDEiXQp9CmBgYAoKIyMgVHJvdWJsZXNob290aW5nCgojIyMgTUNQIHNlcnZlciBub3QgZm91bmQKLSBFbnN1cmUgLm1jcC5qc29uIGV4aXN0cyBpbiBwcm9qZWN0IHJvb3QKLSBTdGFydCBDbGF1ZGUgZnJvbSB0aGUgcHJvamVjdCBkaXJlY3RvcnkKLSBDaGVjazogYGNhdCAubWNwLmpzb24gfCBqcSAuYAoKIyMjIENvbGxlY3Rpb24gZXJyb3JzCi0gVmVyaWZ5IENocm9tYURCIGRpcmVjdG9yeSBleGlzdHM6IGBscyAtbGEgLmNocm9tYS9gCi0gVHJ5IHJlY3JlYXRpbmcgY29sbGVjdGlvbiB3aXRoIGNvbW1hbmQgYWJvdmUKCiMjIyBNZW1vcnkgbm90IHBlcnNpc3RpbmcKLSBDaGVjayBjb2xsZWN0aW9uIG5hbWUgbWF0Y2hlczogIiR7UFJPSkVDVF9DT0xMRUNUSU9OfSIKLSBWZXJpZnkgbWV0YWRhdGEgZm9ybWF0IGlzIGNvcnJlY3QKLSBFbnN1cmUgdW5pcXVlIElEcyBmb3IgZWFjaCBtZW1vcnknCgogICAgd3JpdGVfZmlsZV9zYWZlICJjbGF1ZGVkb2NzL0lOSVRfSU5TVFJVQ1RJT05TLm1kIiAiJGNvbnRlbnQiCiAgICBwcmludF9zdGF0dXMgIkNyZWF0ZWQgaW5pdGlhbGl6YXRpb24gZG9jdW1lbnRhdGlvbiIKfQoKY3JlYXRlX2xhdW5jaGVyKCkgewogICAgcHJpbnRfaW5mbyAiQ3JlYXRpbmcgbGF1bmNoZXIgc2NyaXB0Li4uIgoKICAgIGxvY2FsIGNvbnRlbnQ9JyMhL3Vzci9iaW4vZW52IGJhc2gKc2V0IC1ldW8gcGlwZWZhaWwKCiMgQ2hlY2sgaWYgY29uZmlnIGV4aXN0cwppZiBbWyAhIC1mICIubWNwLmpzb24iIF1dOyB0aGVuCiAgICBlY2hvICLinYwgTm8gTUNQIGNvbmZpZyBmb3VuZCBpbiB0aGlzIGRpcmVjdG9yeSIKICAgIGVjaG8gIlJ1biB0aGUgQ2hyb21hREIgc2V0dXAgc2NyaXB0IGZpcnN0IgogICAgZXhpdCAxCmZpCgojIFZhbGlkYXRlIEpTT04KaWYgISBqcSAtZSAuIC5tY3AuanNvbiA+L2Rldi9udWxsIDI+JjE7IHRoZW4KICAgIGVjaG8gIuKdjCBJbnZhbGlkIC5tY3AuanNvbiBjb25maWd1cmF0aW9uIgogICAgZWNobyAiUnVuOiBqcSAuIC5tY3AuanNvbiB0byBzZWUgdGhlIGVycm9yIgogICAgZXhpdCAxCmZpCgojIE9wdGlvbmFsOiBidW1wIHJlZ2lzdHJ5IHVzYWdlIGlmIGhlbHBlciBleGlzdHMKaWYgW1sgLXggImJpbi9yZWdpc3RyeS5zaCIgXV07IHRoZW4KICBiaW4vcmVnaXN0cnkuc2ggYnVtcCAiJFBXRCIgfHwgdHJ1ZQpmaQplY2hvICLwn5qAIFN0YXJ0aW5nIENsYXVkZSB3aXRoIENocm9tYURCLi4uIgpleGVjIGNsYXVkZSAiJEAiJwoKICAgIHdyaXRlX2ZpbGVfc2FmZSAic3RhcnQtY2xhdWRlLWNocm9tYS5zaCIgIiRjb250ZW50IgoKICAgIGlmIFtbICIkRFJZX1JVTiIgIT0gIjEiIF1dOyB0aGVuCiAgICAgICAgY2htb2QgK3ggc3RhcnQtY2xhdWRlLWNocm9tYS5zaAogICAgZWxzZQogICAgICAgIHByaW50X2luZm8gIltkcnktcnVuXSBXb3VsZCBtYWtlIGV4ZWN1dGFibGU6IHN0YXJ0LWNsYXVkZS1jaHJvbWEuc2giCiAgICBmaQoKICAgIHByaW50X3N0YXR1cyAiQ3JlYXRlZCBsYXVuY2hlciBzY3JpcHQiCn0KCnNldHVwX3NoZWxsX2Z1bmN0aW9uKCkgewogICAgcHJpbnRfaGVhZGVyICLwn5qAIE9wdGlvbmFsOiBTbWFydCBTaGVsbCBGdW5jdGlvbiIKCiAgICBwcmludF9pbmZvICJBZGQgYSBnbG9iYWwgJ2NsYXVkZS1jaHJvbWEnIGZ1bmN0aW9uIHRvIHlvdXIgc2hlbGw/IgogICAgZWNobyAiIgogICAgZWNobyAtZSAiJHtCTFVFfVRoaXMgZnVuY3Rpb24gd2lsbDoke05DfSIKICAgIGVjaG8gIiAg4pyFIFdvcmsgZnJvbSBhbnkgZGlyZWN0b3J5IGluIHlvdXIgcHJvamVjdCB0cmVlIgogICAgZWNobyAiICDinIUgQXV0by1kZXRlY3QgQ2hyb21hREIgY29uZmlnIGZpbGVzIgogICAgZWNobyAiICDinIUgRmFsbCBiYWNrIHRvIHJlZ3VsYXIgQ2xhdWRlIGlmIG5vIGNvbmZpZyBmb3VuZCIKICAgIGVjaG8gIiIKCiAgICBpZiAhIHByb21wdF95ZXMgIkFkZCBjbGF1ZGUtY2hyb21hIGZ1bmN0aW9uPyI7IHRoZW4KICAgICAgICBwcmludF9pbmZvICJTa2lwcGluZyBzaGVsbCBmdW5jdGlvbiBzZXR1cCIKICAgICAgICByZXR1cm4gMAogICAgZmkKCiAgICBsb2NhbCBzaGVsbF9yYwogICAgc2hlbGxfcmM9JChkZXRlY3Rfc2hlbGxfcmMpCiAgICBsb2NhbCBzaGVsbF9uYW1lCiAgICBzaGVsbF9uYW1lPSQoYmFzZW5hbWUgIiR7U0hFTEw6LS9iaW4vYmFzaH0iKQoKICAgIHByaW50X2luZm8gIlNoZWxsOiAkc2hlbGxfbmFtZSIKICAgIHByaW50X2luZm8gIkNvbmZpZzogJHNoZWxsX3JjIgoKICAgICMgQ2hlY2sgaWYgZnVuY3Rpb24gYWxyZWFkeSBleGlzdHMKICAgIGlmIFtbIC1mICIkc2hlbGxfcmMiIF1dICYmIGdyZXAgLXEgImNsYXVkZS1jaHJvbWEoKVx8ZnVuY3Rpb24gY2xhdWRlLWNocm9tYSIgIiRzaGVsbF9yYyIgMj4vZGV2L251bGw7IHRoZW4KICAgICAgICBwcmludF9pbmZvICJjbGF1ZGUtY2hyb21hIGZ1bmN0aW9uIGFscmVhZHkgZXhpc3RzIgogICAgICAgIHJldHVybiAwCiAgICBmaQoKICAgIGJhY2t1cF9pZl9leGlzdHMgIiRzaGVsbF9yYyIKCiAgICBsb2NhbCBmdW5jdGlvbl9jb250ZW50CgogICAgaWYgW1sgIiRzaGVsbF9uYW1lIiA9PSAiZmlzaCIgXV07IHRoZW4KICAgICAgICBmdW5jdGlvbl9jb250ZW50PScKIyBDaHJvbWFEQiBTbWFydCBGdW5jdGlvbiAtIEFkZGVkIGJ5IGNsYXVkZS1jaHJvbWEuc2ggdjMuMwpmdW5jdGlvbiBjbGF1ZGUtY2hyb21hIC0tZGVzY3JpcHRpb24gIlN0YXJ0IENsYXVkZSB3aXRoIGF1dG8tZGV0ZWN0ZWQgQ2hyb21hREIgY29uZmlnIgogICAgc2V0IGNvbmZpZ19maWxlICIiCiAgICBzZXQgc2VhcmNoX2RpciAiJFBXRCIKCiAgICAjIFNlYXJjaCB1cHdhcmQgZm9yIC5tY3AuanNvbgogICAgd2hpbGUgdGVzdCAiJHNlYXJjaF9kaXIiICE9ICIvIgogICAgICAgIGlmIHRlc3QgLWYgIiRzZWFyY2hfZGlyLy5tY3AuanNvbiIKICAgICAgICAgICAgc2V0IGNvbmZpZ19maWxlICIkc2VhcmNoX2Rpci8ubWNwLmpzb24iCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZW5kCiAgICAgICAgc2V0IHNlYXJjaF9kaXIgKGRpcm5hbWUgIiRzZWFyY2hfZGlyIikKICAgIGVuZAoKICAgIGlmIHRlc3QgLW4gIiRjb25maWdfZmlsZSIKICAgICAgICBzZXQgcHJvamVjdF9kaXIgKGRpcm5hbWUgIiRjb25maWdfZmlsZSIpCiAgICAgICAgZWNobyAiVXNpbmcgQ2hyb21hREIgcHJvamVjdDogJHByb2plY3RfZGlyIgogICAgICAgIGNkICIkcHJvamVjdF9kaXIiCiAgICAgICAgaWYgdGVzdCAoY291bnQgJGFyZ3YpIC1lcSAwCiAgICAgICAgICAgIGNsYXVkZQogICAgICAgIGVsc2UKICAgICAgICAgICAgY2xhdWRlICRhcmd2CiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgZWNobyAiTm8gQ2hyb21hREIgY29uZmlnIGZvdW5kIC0gdXNpbmcgcmVndWxhciBDbGF1ZGUiCiAgICAgICAgaWYgdGVzdCAoY291bnQgJGFyZ3YpIC1lcSAwCiAgICAgICAgICAgIGNsYXVkZQogICAgICAgIGVsc2UKICAgICAgICAgICAgY2xhdWRlICRhcmd2CiAgICAgICAgZW5kCiAgICBlbmQKZW5kJwogICAgZWxzZQogICAgICAgIGZ1bmN0aW9uX2NvbnRlbnQ9JwojIENocm9tYURCIFNtYXJ0IEZ1bmN0aW9uIC0gQWRkZWQgYnkgY2xhdWRlLWNocm9tYS5zaCB2My4zCmNsYXVkZS1jaHJvbWEoKSB7CiAgICBsb2NhbCBjb25maWdfZmlsZT0iIgogICAgbG9jYWwgc2VhcmNoX2Rpcj0iJFBXRCIKCiAgICAjIFNlYXJjaCB1cHdhcmQgZm9yIC5tY3AuanNvbgogICAgd2hpbGUgW1sgIiRzZWFyY2hfZGlyIiAhPSAiLyIgXV07IGRvCiAgICAgICAgaWYgW1sgLWYgIiRzZWFyY2hfZGlyLy5tY3AuanNvbiIgXV07IHRoZW4KICAgICAgICAgICAgY29uZmlnX2ZpbGU9IiRzZWFyY2hfZGlyLy5tY3AuanNvbiIKICAgICAgICAgICAgYnJlYWsKICAgICAgICBmaQogICAgICAgIHNlYXJjaF9kaXI9JChkaXJuYW1lICIkc2VhcmNoX2RpciIpCiAgICBkb25lCgogICAgaWYgW1sgLW4gIiRjb25maWdfZmlsZSIgXV07IHRoZW4KICAgICAgICBsb2NhbCBwcm9qZWN0X2Rpcj0kKGRpcm5hbWUgIiRjb25maWdfZmlsZSIpCiAgICAgICAgZWNobyAi8J+noCBVc2luZyBDaHJvbWFEQiBwcm9qZWN0OiAkcHJvamVjdF9kaXIiCiAgICAgICAgY2QgIiRwcm9qZWN0X2RpciIKICAgICAgICBpZiBbWyAkIyAtZXEgMCBdXTsgdGhlbgogICAgICAgICAgICBjbGF1ZGUKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNsYXVkZSAiJEAiCiAgICAgICAgZmkKICAgIGVsc2UKICAgICAgICBlY2hvICLihLnvuI8gIE5vIENocm9tYURCIGNvbmZpZyBmb3VuZCAtIHVzaW5nIHJlZ3VsYXIgQ2xhdWRlIgogICAgICAgIGlmIFtbICQjIC1lcSAwIF1dOyB0aGVuCiAgICAgICAgICAgIGNsYXVkZQogICAgICAgIGVsc2UKICAgICAgICAgICAgY2xhdWRlICIkQCIKICAgICAgICBmaQogICAgZmkKfScKICAgIGZpCgogICAgaWYgW1sgIiREUllfUlVOIiA9PSAiMSIgXV07IHRoZW4KICAgICAgICBwcmludF9pbmZvICJbZHJ5LXJ1bl0gV291bGQgYWRkIGNsYXVkZS1jaHJvbWEgZnVuY3Rpb24gdG8gJHNoZWxsX3JjIgogICAgZWxzZQogICAgICAgIGVjaG8gIiRmdW5jdGlvbl9jb250ZW50IiA+PiAiJHNoZWxsX3JjIgogICAgICAgIHRvdWNoX3RyYWNrICIkc2hlbGxfcmMiCiAgICAgICAgcHJpbnRfc3RhdHVzICJBZGRlZCBjbGF1ZGUtY2hyb21hIGZ1bmN0aW9uIgogICAgZmkKCiAgICBwcmludF9pbmZvICJSZXN0YXJ0IHRlcm1pbmFsIG9yIHJ1bjogc291cmNlICRzaGVsbF9yYyIKfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgTUlHUkFUSU9OIEZST00gT0xERVIgVkVSU0lPTlMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Cm1pZ3JhdGVfZnJvbV92MygpIHsKICAgICMgQ2hlY2sgZm9yIHYzLjAvMy4xIGludmFsaWQgY29uZmlndXJhdGlvbgogICAgaWYgW1sgLWYgIi5jbGF1ZGUvc2V0dGluZ3MubG9jYWwuanNvbiIgXV07IHRoZW4KICAgICAgICBpZiBncmVwIC1xICciaW5zdHJ1Y3Rpb25zIicgLmNsYXVkZS9zZXR0aW5ncy5sb2NhbC5qc29uIDI+L2Rldi9udWxsOyB0aGVuCiAgICAgICAgICAgIHByaW50X2luZm8gIkZvdW5kIGluY29tcGF0aWJsZSB2My4wLzMuMSBjb25maWd1cmF0aW9uIgoKICAgICAgICAgICAgaWYgcHJvbXB0X3llcyAiTWlncmF0ZSBmcm9tIHByZXZpb3VzIHZlcnNpb24/IjsgdGhlbgogICAgICAgICAgICAgICAgYmFja3VwX2lmX2V4aXN0cyAiLmNsYXVkZS9zZXR0aW5ncy5sb2NhbC5qc29uIgoKICAgICAgICAgICAgICAgIGlmIFtbICIkRFJZX1JVTiIgIT0gIjEiIF1dOyB0aGVuCiAgICAgICAgICAgICAgICAgICAgcm0gLWYgLmNsYXVkZS9zZXR0aW5ncy5sb2NhbC5qc29uCgogICAgICAgICAgICAgICAgICAgICMgUmVtb3ZlIGVtcHR5IC5jbGF1ZGUgZGlyZWN0b3J5CiAgICAgICAgICAgICAgICAgICAgaWYgW1sgLWQgIi5jbGF1ZGUiIF1dICYmIFtbIC16ICIkKGxzIC1BIC5jbGF1ZGUgMj4vZGV2L251bGwpIiBdXTsgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBybWRpciAuY2xhdWRlCiAgICAgICAgICAgICAgICAgICAgZmkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBwcmludF9pbmZvICJbZHJ5LXJ1bl0gV291bGQgcmVtb3ZlIGludmFsaWQgLmNsYXVkZS9zZXR0aW5ncy5sb2NhbC5qc29uIgogICAgICAgICAgICAgICAgZmkKCiAgICAgICAgICAgICAgICBwcmludF9zdGF0dXMgIk1pZ3JhdGVkIGZyb20gdjMuMC8zLjEiCiAgICAgICAgICAgIGZpCiAgICAgICAgZmkKICAgIGZpCn0KCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIFNIRUxMIEZVTkNUSU9OIE1JR1JBVElPTgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KY2hlY2tfYnJva2VuX3NoZWxsX2Z1bmN0aW9uKCkgewogICAgcHJpbnRfaW5mbyAiQ2hlY2tpbmcgZm9yIGJyb2tlbiBzaGVsbCBmdW5jdGlvbnMuLi4iCgogICAgbG9jYWwgc2hlbGxfcmMKICAgIHNoZWxsX3JjPSQoZGV0ZWN0X3NoZWxsX3JjKQoKICAgIGlmIFtbICEgLWYgIiRzaGVsbF9yYyIgXV07IHRoZW4KICAgICAgICByZXR1cm4gMAogICAgZmkKCiAgICAjIENoZWNrIGlmIGZ1bmN0aW9uIGV4aXN0cyBhbmQgaXMgYnJva2VuIChsb29raW5nIGZvciBvbGQgY29uZmlnIGZpbGUpCiAgICBpZiBncmVwIC1xICJjbGF1ZGUtY2hyb21hKCkiICIkc2hlbGxfcmMiIDI+L2Rldi9udWxsOyB0aGVuCiAgICAgICAgaWYgZ3JlcCAtcSAnXC5jbGF1ZGUvc2V0dGluZ3NcLmxvY2FsXC5qc29uJyAiJHNoZWxsX3JjIiAyPi9kZXYvbnVsbDsgdGhlbgogICAgICAgICAgICBwcmludF93YXJuaW5nICJGb3VuZCBvdXRkYXRlZCBjbGF1ZGUtY2hyb21hIGZ1bmN0aW9uIGluICRzaGVsbF9yYyIKICAgICAgICAgICAgcHJpbnRfaW5mbyAiVGhpcyBmdW5jdGlvbiBsb29rcyBmb3IgdGhlIG9sZCBjb25maWcgZmlsZSBsb2NhdGlvbiIKCiAgICAgICAgICAgIGlmIHByb21wdF95ZXMgIlVwZGF0ZSBjbGF1ZGUtY2hyb21hIGZ1bmN0aW9uIHRvIHdvcmsgd2l0aCBjdXJyZW50IHZlcnNpb24/IjsgdGhlbgogICAgICAgICAgICAgICAgYmFja3VwX2lmX2V4aXN0cyAiJHNoZWxsX3JjIgoKICAgICAgICAgICAgICAgIGlmIFtbICIkRFJZX1JVTiIgIT0gIjEiIF1dOyB0aGVuCiAgICAgICAgICAgICAgICAgICAgIyBSZW1vdmUgb2xkIGZ1bmN0aW9uCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdG1wX2ZpbGU9IiR7c2hlbGxfcmN9LnRtcC4kJCIKICAgICAgICAgICAgICAgICAgICBhd2sgJwogICAgICAgICAgICAgICAgICAgICAgICAvXltbOnNwYWNlOl1dKmNsYXVkZS1jaHJvbWFcKFwpLyB7IGluX2Z1bmM9MSB9CiAgICAgICAgICAgICAgICAgICAgICAgIGluX2Z1bmMgJiYgL159LyB7IGluX2Z1bmM9MDsgbmV4dCB9CiAgICAgICAgICAgICAgICAgICAgICAgICFpbl9mdW5jIHsgcHJpbnQgfQogICAgICAgICAgICAgICAgICAgICcgIiRzaGVsbF9yYyIgPiAiJHRtcF9maWxlIgoKICAgICAgICAgICAgICAgICAgICBtdiAiJHRtcF9maWxlIiAiJHNoZWxsX3JjIgoKICAgICAgICAgICAgICAgICAgICAjIEFkZCB1cGRhdGVkIGZ1bmN0aW9uCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZnVuY3Rpb25fY29udGVudD0nCiMgQ2hyb21hREIgU21hcnQgRnVuY3Rpb24gLSBVcGRhdGVkIGJ5IGNsYXVkZS1jaHJvbWEuc2ggdjMuMwpjbGF1ZGUtY2hyb21hKCkgewogICAgbG9jYWwgY29uZmlnX2ZpbGU9IiIKICAgIGxvY2FsIHNlYXJjaF9kaXI9IiRQV0QiCgogICAgIyBTZWFyY2ggdXB3YXJkIGZvciAubWNwLmpzb24KICAgIHdoaWxlIFtbICIkc2VhcmNoX2RpciIgIT0gIi8iIF1dOyBkbwogICAgICAgIGlmIFtbIC1mICIkc2VhcmNoX2Rpci8ubWNwLmpzb24iIF1dOyB0aGVuCiAgICAgICAgICAgIGNvbmZpZ19maWxlPSIkc2VhcmNoX2Rpci8ubWNwLmpzb24iCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZmkKICAgICAgICBzZWFyY2hfZGlyPSQoZGlybmFtZSAiJHNlYXJjaF9kaXIiKQogICAgZG9uZQoKICAgIGlmIFtbIC1uICIkY29uZmlnX2ZpbGUiIF1dOyB0aGVuCiAgICAgICAgbG9jYWwgcHJvamVjdF9kaXI9JChkaXJuYW1lICIkY29uZmlnX2ZpbGUiKQogICAgICAgIGVjaG8gIvCfp6AgVXNpbmcgQ2hyb21hREIgcHJvamVjdDogJHByb2plY3RfZGlyIgogICAgICAgIGNkICIkcHJvamVjdF9kaXIiCiAgICAgICAgaWYgW1sgJCMgLWVxIDAgXV07IHRoZW4KICAgICAgICAgICAgY2xhdWRlCiAgICAgICAgZWxzZQogICAgICAgICAgICBjbGF1ZGUgIiRAIgogICAgICAgIGZpCiAgICBlbHNlCiAgICAgICAgZWNobyAi4oS577iPICBObyBDaHJvbWFEQiBjb25maWcgZm91bmQgLSB1c2luZyByZWd1bGFyIENsYXVkZSIKICAgICAgICBpZiBbWyAkIyAtZXEgMCBdXTsgdGhlbgogICAgICAgICAgICBjbGF1ZGUKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNsYXVkZSAiJEAiCiAgICAgICAgZmkKICAgIGZpCn0nCiAgICAgICAgICAgICAgICAgICAgZWNobyAiJGZ1bmN0aW9uX2NvbnRlbnQiID4+ICIkc2hlbGxfcmMiCiAgICAgICAgICAgICAgICAgICAgcHJpbnRfc3RhdHVzICJVcGRhdGVkIGNsYXVkZS1jaHJvbWEgZnVuY3Rpb24iCiAgICAgICAgICAgICAgICAgICAgcHJpbnRfaW5mbyAiUmVzdGFydCB0ZXJtaW5hbCBvciBydW46IHNvdXJjZSAkc2hlbGxfcmMiCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcHJpbnRfaW5mbyAiW2RyeS1ydW5dIFdvdWxkIHVwZGF0ZSBjbGF1ZGUtY2hyb21hIGZ1bmN0aW9uIGluICRzaGVsbF9yYyIKICAgICAgICAgICAgICAgIGZpCiAgICAgICAgICAgIGZpCiAgICAgICAgZmkKICAgIGZpCn0KCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIE1DUCBDT05GSUcgVElNRU9VVCBWQUxJREFUSU9OCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpjaGVja19tY3BfdGltZW91dF9zZXR0aW5ncygpIHsKICAgIGlmIFtbICEgLWYgIi5tY3AuanNvbiIgXV07IHRoZW4KICAgICAgICByZXR1cm4gMAogICAgZmkKCiAgICBwcmludF9pbmZvICJDaGVja2luZyBleGlzdGluZyAubWNwLmpzb24gZm9yIHRpbWVvdXQgc2V0dGluZ3MuLi4iCgogICAgIyBDaGVjayBpZiB0aW1lb3V0IHNldHRpbmdzIGV4aXN0CiAgICBsb2NhbCBoYXNfdGltZW91dF9zZXR0aW5ncz0wCgogICAgaWYganEgLWUgJy5tY3BTZXJ2ZXJzLmNocm9tYS5lbnYuQ0hST01BX1NFUlZFUl9LRUVQX0FMSVZFJyAubWNwLmpzb24gPi9kZXYvbnVsbCAyPiYxOyB0aGVuCiAgICAgICAgaWYgW1sgJChqcSAtciAnLm1jcFNlcnZlcnMuY2hyb21hLmVudi5DSFJPTUFfU0VSVkVSX0tFRVBfQUxJVkUnIC5tY3AuanNvbikgPT0gIjAiIF1dOyB0aGVuCiAgICAgICAgICAgIGhhc190aW1lb3V0X3NldHRpbmdzPTEKICAgICAgICBmaQogICAgZmkKCiAgICBpZiBbWyAiJGhhc190aW1lb3V0X3NldHRpbmdzIiAtZXEgMCBdXTsgdGhlbgogICAgICAgIHByaW50X3dhcm5pbmcgIkV4aXN0aW5nIC5tY3AuanNvbiBsYWNrcyBpbmZpbml0ZSB0aW1lb3V0IHNldHRpbmdzIgogICAgICAgIHByaW50X2luZm8gIldpdGhvdXQgdGhlc2Ugc2V0dGluZ3MsIENocm9tYURCIG1heSBkaXNjb25uZWN0IGFmdGVyIGluYWN0aXZpdHkiCgogICAgICAgIGlmIHByb21wdF95ZXMgIlVwZGF0ZSAubWNwLmpzb24gd2l0aCB0aW1lb3V0IHByZXZlbnRpb24gc2V0dGluZ3M/IjsgdGhlbgogICAgICAgICAgICBiYWNrdXBfaWZfZXhpc3RzICIubWNwLmpzb24iCgogICAgICAgICAgICBpZiBbWyAiJERSWV9SVU4iICE9ICIxIiBdXTsgdGhlbgogICAgICAgICAgICAgICAgIyBVcGRhdGUgdGhlIGNvbmZpZyB3aXRoIHRpbWVvdXQgc2V0dGluZ3MKICAgICAgICAgICAgICAgIGxvY2FsIHVwZGF0ZWRfY29uZmlnCiAgICAgICAgICAgICAgICB1cGRhdGVkX2NvbmZpZz0kKGpxICcKICAgICAgICAgICAgICAgICAgICAubWNwU2VydmVycy5jaHJvbWEuZW52LkNIUk9NQV9TRVJWRVJfS0VFUF9BTElWRSA9ICIwIiB8CiAgICAgICAgICAgICAgICAgICAgLm1jcFNlcnZlcnMuY2hyb21hLmVudi5DSFJPTUFfQ0xJRU5UX1RJTUVPVVQgPSAiMCIgfAogICAgICAgICAgICAgICAgICAgIC5tY3BTZXJ2ZXJzLmNocm9tYS5pbml0aWFsaXphdGlvbk9wdGlvbnMudGltZW91dCA9IDAgfAogICAgICAgICAgICAgICAgICAgIC5tY3BTZXJ2ZXJzLmNocm9tYS5pbml0aWFsaXphdGlvbk9wdGlvbnMua2VlcEFsaXZlID0gdHJ1ZSB8CiAgICAgICAgICAgICAgICAgICAgLm1jcFNlcnZlcnMuY2hyb21hLmluaXRpYWxpemF0aW9uT3B0aW9ucy5yZXRyeUF0dGVtcHRzID0gNQogICAgICAgICAgICAgICAgJyAubWNwLmpzb24pCgogICAgICAgICAgICAgICAgZWNobyAiJHVwZGF0ZWRfY29uZmlnIiA+IC5tY3AuanNvbgogICAgICAgICAgICAgICAgcHJpbnRfc3RhdHVzICJVcGRhdGVkIC5tY3AuanNvbiB3aXRoIHRpbWVvdXQgcHJldmVudGlvbiBzZXR0aW5ncyIKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcHJpbnRfaW5mbyAiW2RyeS1ydW5dIFdvdWxkIHVwZGF0ZSAubWNwLmpzb24gd2l0aCB0aW1lb3V0IHNldHRpbmdzIgogICAgICAgICAgICBmaQogICAgICAgIGZpCiAgICBlbHNlCiAgICAgICAgcHJpbnRfc3RhdHVzICJUaW1lb3V0IHNldHRpbmdzIGFscmVhZHkgY29uZmlndXJlZCBjb3JyZWN0bHkiCiAgICBmaQp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGSU5BTCBTVU1NQVJZCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpwcmludF9zdW1tYXJ5KCkgewogICAgcHJpbnRfaGVhZGVyICLinKggU2V0dXAgQ29tcGxldGUhIgoKICAgIGVjaG8gIlByb2plY3Q6ICRQUk9KRUNUX05BTUUiCiAgICBlY2hvICJQYXRoOiAkUFJPSkVDVF9ESVIiCiAgICBlY2hvICIiCgogICAgaWYgW1sgIiREUllfUlVOIiA9PSAiMSIgXV07IHRoZW4KICAgICAgICBwcmludF93YXJuaW5nICJEUlkgUlVOIE1PREUgLSBObyBjaGFuZ2VzIHdlcmUgbWFkZSIKICAgICAgICBlY2hvICIiCiAgICAgICAgZWNobyAiVG8gYXBwbHkgY2hhbmdlcywgcnVuIHdpdGhvdXQgRFJZX1JVTjoiCiAgICAgICAgZWNobyAiICBEUllfUlVOPTAgJDAgJCoiCiAgICBlbHNlCiAgICAgICAgcHJpbnRfc3RhdHVzICJDaHJvbWFEQiBNQ1Agc2VydmVyIGNvbmZpZ3VyZWQiCiAgICAgICAgcHJpbnRfc3RhdHVzICJQcm9qZWN0IGluc3RydWN0aW9ucyBpbiBDTEFVREUubWQiCiAgICAgICAgcHJpbnRfc3RhdHVzICJBbGwgZmlsZXMgYmFja2VkIHVwIGJlZm9yZSBtb2RpZmljYXRpb24iCgogICAgICAgIGVjaG8gIiIKICAgICAgICBwcmludF9pbmZvICJEaXJlY3Rvcnkgc3RydWN0dXJlOiIKICAgICAgICBpZiBjb21tYW5kIC12IHRyZWUgPi9kZXYvbnVsbCAyPiYxOyB0aGVuCiAgICAgICAgICAgIHRyZWUgLWEgLUwgMiAuIDI+L2Rldi9udWxsIHwgaGVhZCAtMjAKICAgICAgICBlbHNlCiAgICAgICAgICAgIGxzIC1sYSAuIHwgaGVhZCAtMTAKICAgICAgICBmaQoKICAgICAgICBlY2hvICIiCiAgICAgICAgcHJpbnRfaW5mbyAiTmV4dCBzdGVwczoiCiAgICAgICAgZWNobyAiICAxLiBjZCBcIiRQUk9KRUNUX0RJUlwiIgogICAgICAgIGVjaG8gIiAgMi4gUnVuIE9ORSBvZiB0aGVzZSBjb21tYW5kczoiCiAgICAgICAgZWNobyAiICAgICAkIGNsYXVkZSAgICAgICAgICAgKHN0YXJ0cyBDbGF1ZGUgd2l0aCBDaHJvbWFEQikiCiAgICAgICAgZWNobyAiICAgICAkIC4vc3RhcnQtY2xhdWRlLWNocm9tYS5zaCIKICAgICAgICBlY2hvICIgIDMuIENsYXVkZSBhdXRvLWluaXRpYWxpemVzIENocm9tYURCIgoKICAgICAgICBlY2hvICIiCiAgICAgICAgcHJpbnRfaW5mbyAiVGhlIHN5c3RlbSB3aWxsOiIKICAgICAgICBlY2hvICIgIOKAoiBBdXRvLWRldGVjdCAubWNwLmpzb24gY29uZmlndXJhdGlvbiIKICAgICAgICBlY2hvICIgIOKAoiBBdXRvLWNyZWF0ZSBjb2xsZWN0aW9uIGlmIG5lZWRlZCIKICAgICAgICBlY2hvICIgIOKAoiBBdXRvLWxvZyBtZW1vcmllcyBkdXJpbmcgd29yayIKICAgICAgICBlY2hvICIgIOKAoiBQZXJzaXN0IGtub3dsZWRnZSBhY3Jvc3Mgc2Vzc2lvbnMiCiAgICBmaQp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBQUk9KRUNUIFJFR0lTVFJZCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQphZGRfdG9fcmVnaXN0cnkoKSB7CiAgICAjIFVzZSBYREcgY29uZmlnIGhvbWUgaWYgYXZhaWxhYmxlCiAgICBsb2NhbCBjb25maWdfZGlyPSIke1hER19DT05GSUdfSE9NRTotJEhPTUUvLmNvbmZpZ30iCiAgICBsb2NhbCByZWdpc3RyeT0iJGNvbmZpZ19kaXIvY2xhdWRlL2Nocm9tYV9wcm9qZWN0cy5qc29ubCIKICAgIGxvY2FsIHRpbWVzdGFtcD0kKGRhdGUgLXUgKyVZLSVtLSVkVCVIOiVNOiVTWikKCiAgICAjIENyZWF0ZSByZWdpc3RyeSBkaXJlY3RvcnkgaWYgbmVlZGVkCiAgICBta2RpciAtcCAiJChkaXJuYW1lICIkcmVnaXN0cnkiKSIKCiAgICAjIEFkZCBlbnRyeSBpZiBub3QgYWxyZWFkeSBwcmVzZW50IChKU09OTCBmb3JtYXQpCiAgICBpZiAhIGdyZXAgLUZxICJcInBhdGhcIjpcIiRQUk9KRUNUX0RJUlwiIiAiJHJlZ2lzdHJ5IiAyPi9kZXYvbnVsbDsgdGhlbgogICAgICAgIHByaW50ZiAneyJuYW1lIjoiJXMiLCJwYXRoIjoiJXMiLCJjb2xsZWN0aW9uIjoiJXMiLCJkYXRhX2RpciI6IiVzLy5jaHJvbWEiLCJjcmVhdGVkX2F0IjoiJXMiLCJzZXNzaW9ucyI6MH1cbicgXAogICAgICAgICAgICAiJFBST0pFQ1RfTkFNRSIgIiRQUk9KRUNUX0RJUiIgIiRQUk9KRUNUX0NPTExFQ1RJT04iICIkUFJPSkVDVF9ESVIiICIkdGltZXN0YW1wIiA+PiAiJHJlZ2lzdHJ5IgogICAgZmkKfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgTUFJTiBFWEVDVVRJT04KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Cm1haW4oKSB7CiAgICAjIEhhbmRsZSBjb21tYW5kLWxpbmUgYXJndW1lbnRzCiAgICB3aGlsZSBbWyAkIyAtZ3QgMCBdXTsgZG8KICAgICAgICBjYXNlICIkMSIgaW4KICAgICAgICAgICAgLS1kcnktcnVuKQogICAgICAgICAgICAgICAgRFJZX1JVTj0xCiAgICAgICAgICAgICAgICBwcmludF93YXJuaW5nICJEUlkgUlVOIE1PREUgLSBObyBjaGFuZ2VzIHdpbGwgYmUgbWFkZSIKICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgIC0tbm9uLWludGVyYWN0aXZlKQogICAgICAgICAgICAgICAgTk9OX0lOVEVSQUNUSVZFPTEKICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgIC0teWVzfC15KQogICAgICAgICAgICAgICAgQVNTVU1FX1lFUz0xCiAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICAtLWRlYnVnKQogICAgICAgICAgICAgICAgREVCVUc9MQogICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgLS12ZXJzaW9uKQogICAgICAgICAgICAgICAgZWNobyAiY2xhdWRlLWNocm9tYS5zaCB2ZXJzaW9uICRTQ1JJUFRfVkVSU0lPTiIKICAgICAgICAgICAgICAgIGV4aXQgMAogICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgLS1taW5pbWFsKQogICAgICAgICAgICAgICAgTUlOSU1BTD0xCiAgICAgICAgICAgICAgICBGVUxMPTAKICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgIC0tZnVsbCkKICAgICAgICAgICAgICAgIEZVTEw9MQogICAgICAgICAgICAgICAgTUlOSU1BTD0wCiAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICAtLWNvbGxlY3Rpb24pCiAgICAgICAgICAgICAgICBzaGlmdAogICAgICAgICAgICAgICAgQ0hST01BX0NPTExFQ1RJT05fT1ZFUlJJREU9IiR7MTotfSIKICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgIC0tZGF0YS1kaXIpCiAgICAgICAgICAgICAgICBzaGlmdAogICAgICAgICAgICAgICAgREFUQV9ESVJfT1ZFUlJJREU9IiR7MTotfSIKICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgIC0tcHJpbnQtY29sbGVjdGlvbikKICAgICAgICAgICAgICAgICMgSnVzdCBwcmludCB0aGUgY29sbGVjdGlvbiBuYW1lIGFuZCBleGl0CiAgICAgICAgICAgICAgICBzaGlmdAogICAgICAgICAgICAgICAgUFJPSkVDVF9OQU1FPSIkezE6LSQoYmFzZW5hbWUgIiRQV0QiKX0iCiAgICAgICAgICAgICAgICA6ICIke0NIUk9NQV9DT0xMRUNUSU9OX09WRVJSSURFOj19IgogICAgICAgICAgICAgICAgZGVyaXZlX2NvbGxlY3Rpb25fbmFtZSgpIHsKICAgICAgICAgICAgICAgICAgICBsb2NhbCBiYXNlPSIke1BST0pFQ1RfTkFNRTotJChiYXNlbmFtZSAiJFBXRCIpfSIKICAgICAgICAgICAgICAgICAgICBpZiBjb21tYW5kIC12IGljb252ID4vZGV2L251bGwgMj4mMTsgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBiYXNlPSIkKHByaW50ZiAnJXMnICIkYmFzZSIgfCBpY29udiAtZiB1dGYtOCAtdCBhc2NpaS8vVFJBTlNMSVQgMj4vZGV2L251bGwgfHwgcHJpbnRmICclcycgIiRiYXNlIikiCiAgICAgICAgICAgICAgICAgICAgZmkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBub3JtCiAgICAgICAgICAgICAgICAgICAgbm9ybT0iJChwcmludGYgJyVzJyAiJGJhc2UiIHwgdHIgJ1s6dXBwZXI6XSAuLS8nICdbOmxvd2VyOl1fX18nIHwgc2VkICdzL1teYS16MC05X10vXy9nJykiCiAgICAgICAgICAgICAgICAgICAgbm9ybT0iJHtub3JtOjA6NDh9IgogICAgICAgICAgICAgICAgICAgIHByaW50ZiAnJXNfbWVtb3J5JyAiJG5vcm0iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBQUk9KRUNUX0NPTExFQ1RJT049IiR7Q0hST01BX0NPTExFQ1RJT05fT1ZFUlJJREU6LSQoZGVyaXZlX2NvbGxlY3Rpb25fbmFtZSl9IgogICAgICAgICAgICAgICAgZWNobyAiJFBST0pFQ1RfQ09MTEVDVElPTiIKICAgICAgICAgICAgICAgIGV4aXQgMAogICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgLS1oZWxwKQogICAgICAgICAgICAgICAgZWNobyAiVXNhZ2U6ICQwIFtQUk9KRUNUX05BTUVdIFtQUk9KRUNUX1BBVEhdIFtPUFRJT05TXSIKICAgICAgICAgICAgICAgIGVjaG8gIiIKICAgICAgICAgICAgICAgIGVjaG8gIk9wdGlvbnM6IgogICAgICAgICAgICAgICAgZWNobyAiICAtLWRyeS1ydW4gICAgICAgICAgUHJldmlldyBjaGFuZ2VzIHdpdGhvdXQgYXBwbHlpbmciCiAgICAgICAgICAgICAgICBlY2hvICIgIC0tbm9uLWludGVyYWN0aXZlICBSdW4gd2l0aG91dCBwcm9tcHRzIgogICAgICAgICAgICAgICAgZWNobyAiICAtLXllcywgLXkgICAgICAgICAgQXNzdW1lIHllcyB0byBhbGwgcHJvbXB0cyIKICAgICAgICAgICAgICAgIGVjaG8gIiAgLS1kZWJ1ZyAgICAgICAgICAgIFNob3cgZGVidWcgb3V0cHV0IgogICAgICAgICAgICAgICAgZWNobyAiICAtLWNvbGxlY3Rpb24gTkFNRSAgT3ZlcnJpZGUgY29sbGVjdGlvbiBuYW1lIgogICAgICAgICAgICAgICAgZWNobyAiICAtLWRhdGEtZGlyIFBBVEggICAgT3ZlcnJpZGUgZGF0YSBkaXJlY3RvcnkiCiAgICAgICAgICAgICAgICBlY2hvICIgIC0tcHJpbnQtY29sbGVjdGlvbiBQcmludCBjb2xsZWN0aW9uIG5hbWUgYW5kIGV4aXQiCiAgICAgICAgICAgICAgICBlY2hvICIgIC0tdmVyc2lvbiAgICAgICAgICBTaG93IHZlcnNpb24iCiAgICAgICAgICAgICAgICBlY2hvICIgIC0taGVscCAgICAgICAgICAgICBTaG93IHRoaXMgaGVscCIKICAgICAgICAgICAgICAgIGVjaG8gIiIKICAgICAgICAgICAgICAgIGVjaG8gIkVudmlyb25tZW50IHZhcmlhYmxlczoiCiAgICAgICAgICAgICAgICBlY2hvICIgIERSWV9SVU49MSAgICAgICAgICBTYW1lIGFzIC0tZHJ5LXJ1biIKICAgICAgICAgICAgICAgIGVjaG8gIiAgTk9OX0lOVEVSQUNUSVZFPTEgIFNhbWUgYXMgLS1ub24taW50ZXJhY3RpdmUiCiAgICAgICAgICAgICAgICBlY2hvICIgIEFTU1VNRV9ZRVM9MSAgICAgICBTYW1lIGFzIC0teWVzIgogICAgICAgICAgICAgICAgZWNobyAiICBERUJVRz0xICAgICAgICAgICAgU2FtZSBhcyAtLWRlYnVnIgogICAgICAgICAgICAgICAgZXhpdCAwCiAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICAqKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIDs7CiAgICAgICAgZXNhYwogICAgICAgIHNoaWZ0CiAgICBkb25lCgogICAgIyBHZXQgcHJvamVjdCBuYW1lIGFuZCBwYXRoIGZyb20gcmVtYWluaW5nIGFyZ3VtZW50cwogICAgbG9jYWwgcHJvamVjdF9uYW1lPSIkezE6LX0iCiAgICBsb2NhbCBwcm9qZWN0X3BhdGg9IiR7MjotfSIKCiAgICAjIFNhbml0aXplIGlucHV0cwogICAgcHJvamVjdF9uYW1lPSQoc2FuaXRpemVfaW5wdXQgIiRwcm9qZWN0X25hbWUiKQoKICAgICMgRGVmYXVsdCBwYXRoIGRldGVjdGlvbgogICAgaWYgW1sgLXogIiRwcm9qZWN0X3BhdGgiIF1dOyB0aGVuCiAgICAgICAgaWYgW1sgLXogIiRwcm9qZWN0X25hbWUiIF1dOyB0aGVuCiAgICAgICAgICAgICMgTm8gYXJndW1lbnRzIC0gdXNlIGN1cnJlbnQgZGlyZWN0b3J5CiAgICAgICAgICAgIHByb2plY3RfcGF0aD0iJChwd2QpIgogICAgICAgIGVsaWYgW1sgLWQgIiRIT01FL3Byb2plY3RzIiBdXTsgdGhlbgogICAgICAgICAgICBwcm9qZWN0X3BhdGg9IiRIT01FL3Byb2plY3RzIgogICAgICAgIGVsaWYgW1sgLWQgIiRIT01FL0RvY3VtZW50cy9wcm9qZWN0cyIgXV07IHRoZW4KICAgICAgICAgICAgcHJvamVjdF9wYXRoPSIkSE9NRS9Eb2N1bWVudHMvcHJvamVjdHMiCiAgICAgICAgZWxpZiBbWyAtZCAiJEhPTUUvRGVza3RvcC9wcm9qZWN0cyIgXV07IHRoZW4KICAgICAgICAgICAgcHJvamVjdF9wYXRoPSIkSE9NRS9EZXNrdG9wL3Byb2plY3RzIgogICAgICAgIGVsc2UKICAgICAgICAgICAgcHJvamVjdF9wYXRoPSIkSE9NRSIKICAgICAgICAgICAgcHJpbnRfaW5mbyAiVXNpbmcgaG9tZSBkaXJlY3RvcnkuIENvbnNpZGVyIGNyZWF0aW5nIH4vcHJvamVjdHMvIgogICAgICAgIGZpCiAgICBmaQoKICAgIHByb2plY3RfcGF0aD0kKHNhbml0aXplX2lucHV0ICIkcHJvamVjdF9wYXRoIikKCiAgICAjIFJ1biBzZXR1cAogICAgY2hlY2tfcHJlcmVxdWlzaXRlcwogICAgc2V0dXBfcHJvamVjdF9kaXJlY3RvcnkgIiRwcm9qZWN0X25hbWUiICIkcHJvamVjdF9wYXRoIgoKICAgICMgRGVyaXZlIGEgcGVyLXByb2plY3QgY29sbGVjdGlvbiBuYW1lCiAgICA6ICIke0NIUk9NQV9DT0xMRUNUSU9OX09WRVJSSURFOj19IgogICAgZGVyaXZlX2NvbGxlY3Rpb25fbmFtZSgpIHsKICAgICAgICBsb2NhbCBiYXNlPSIke1BST0pFQ1RfTkFNRTotJChiYXNlbmFtZSAiJFBXRCIpfSIKICAgICAgICAjIFRyYW5zbGl0ZXJhdGUgbm9uLUFTQ0lJIGNoYXJhY3RlcnMgaWYgaWNvbnYgaXMgYXZhaWxhYmxlCiAgICAgICAgaWYgY29tbWFuZCAtdiBpY29udiA+L2Rldi9udWxsIDI+JjE7IHRoZW4KICAgICAgICAgICAgYmFzZT0iJChwcmludGYgJyVzJyAiJGJhc2UiIHwgaWNvbnYgLWYgdXRmLTggLXQgYXNjaWkvL1RSQU5TTElUIDI+L2Rldi9udWxsIHx8IHByaW50ZiAnJXMnICIkYmFzZSIpIgogICAgICAgIGZpCiAgICAgICAgIyBub3JtYWxpemU6IGxvd2VyLCByZXBsYWNlIG5vbiBbYS16MC05X10gd2l0aCBfCiAgICAgICAgbG9jYWwgbm9ybQogICAgICAgIG5vcm09IiQocHJpbnRmICclcycgIiRiYXNlIiB8IHRyICdbOnVwcGVyOl0gLi0vJyAnWzpsb3dlcjpdX19fJyB8IHNlZCAncy9bXmEtejAtOV9dL18vZycpIgogICAgICAgICMgY2xhbXAgdG8gcmVhc29uYWJsZSBsZW5ndGgKICAgICAgICBub3JtPSIke25vcm06MDo0OH0iCiAgICAgICAgcHJpbnRmICclc19tZW1vcnknICIkbm9ybSIKICAgIH0KICAgIFBST0pFQ1RfQ09MTEVDVElPTj0iJHtDSFJPTUFfQ09MTEVDVElPTl9PVkVSUklERTotJChkZXJpdmVfY29sbGVjdGlvbl9uYW1lKX0iCgogICAgbWlncmF0ZV9mcm9tX3YzCiAgICBjaGVja19icm9rZW5fc2hlbGxfZnVuY3Rpb24KICAgIGNyZWF0ZV9kaXJlY3Rvcnlfc3RydWN0dXJlCiAgICBjcmVhdGVfbWNwX2NvbmZpZwogICAgY2hlY2tfbWNwX3RpbWVvdXRfc2V0dGluZ3MKICAgIGNyZWF0ZV9jbGF1ZGVfbWQKICAgIGVuc3VyZV9tZW1vcnlfZGlzY2lwbGluZQogICAgZW5zdXJlX3NldHRpbmdzX21lbW9yeV9kaXNjaXBsaW5lCiAgICBjcmVhdGVfZ2l0aWdub3JlCiAgICBjcmVhdGVfaW5pdF9kb2NzCiAgICBjcmVhdGVfbGF1bmNoZXIKICAgICMgU2hlbGwgZnVuY3Rpb24gaXMgT0ZGIGJ5IGRlZmF1bHQ7IG9ubHkgaW4gLS1mdWxsIG1vZGUKICAgIGlmIFtbICIkRlVMTCIgPT0gIjEiIF1dOyB0aGVuCiAgICAgICAgc2V0dXBfc2hlbGxfZnVuY3Rpb24KICAgIGVsc2UKICAgICAgICBwcmludF9pbmZvICJMZWFuIG1vZGU6IHNraXBwaW5nIHNoZWxsIGZ1bmN0aW9uIGluc3RhbGxlciAodXNlIC0tZnVsbCB0byBlbmFibGUpIgogICAgZmkKICAgIGFkZF90b19yZWdpc3RyeQogICAgcHJpbnRfc3VtbWFyeQp9CgojIFJ1biBtYWluIGZ1bmN0aW9uCm1haW4gIiRAIg==
SCRIPT_BASE64
chmod +x "$TEMP_DIR/claude-chroma.sh"

# Extract template
echo -e "${BLUE}â³ Extracting template...${NC}"
mkdir -p "$PROJECT_DIR/templates"
base64 -d > "$PROJECT_DIR/templates/CLAUDE.md.tpl" <<'TEMPLATE_BASE64'
IyBDTEFVREUubWQg4oCUIFByb2plY3QgQ29udHJhY3QKCioqUHVycG9zZSoqOiBGb2xsb3cgdGhpcyBpbiBldmVyeSBzZXNzaW9uIGZvciB0aGlzIHJlcG8uIEtlZXAgbWVtb3J5IHNoYXJwLiBLZWVwIG91dHB1dHMgY29uY3JldGUuIEN1dCByZXdvcmsuCgojIyDwn6egIFByb2plY3QgTWVtb3J5IChDaHJvbWEpClVzZSBzZXJ2ZXIgYGNocm9tYWAuIENvbGxlY3Rpb24gYCR7UFJPSkVDVF9DT0xMRUNUSU9OfWAuCgpMb2cgYWZ0ZXIgYW55IGNvbmZpcm1lZCBmaXgsIGRlY2lzaW9uLCBnb3RjaGEsIG9yIHByZWZlcmVuY2UuCgoqKlNjaGVtYToqKgotICoqZG9jdW1lbnRzKio6IDHigJMyIHNlbnRlbmNlcy4gVW5kZXIgMzAwIGNoYXJzLgotICoqbWV0YWRhdGFzKio6IGB7ICJ0eXBlIjoiZGVjaXNpb258Zml4fHRpcHxwcmVmZXJlbmNlIiwgInRhZ3MiOiJjb21tYSxzZXBhcmF0ZWQiLCAic291cmNlIjoiZmlsZXxQUnxzcGVjfGlzc3VlIiB9YAotICoqaWRzKio6IHN0YWJsZSBzdHJpbmcgaWYgdXBkYXRpbmcgdGhlIHNhbWUgZmFjdC4KCiMjIyBDaHJvbWEgQ2FsbHMKYGBgamF2YXNjcmlwdAovLyBDcmVhdGUgb25jZToKbWNwX19jaHJvbWFfX2Nocm9tYV9jcmVhdGVfY29sbGVjdGlvbiB7ICJjb2xsZWN0aW9uX25hbWUiOiAiJHtQUk9KRUNUX0NPTExFQ1RJT059IiB9CgovLyBBZGQ6Cm1jcF9fY2hyb21hX19jaHJvbWFfYWRkX2RvY3VtZW50cyB7CiAgImNvbGxlY3Rpb25fbmFtZSI6ICIke1BST0pFQ1RfQ09MTEVDVElPTn0iLAogICJkb2N1bWVudHMiOiBbIjx0ZXh0PiJdLAogICJtZXRhZGF0YXMiOiBbeyJ0eXBlIjoiPHR5cGU+IiwidGFncyI6ImEsYixjIiwic291cmNlIjoiPHNyYz4ifV0sCiAgImlkcyI6IFsiPHN0YWJsZS1pZD4iXQp9CgovLyBRdWVyeSAoc3RhcnQgd2l0aCA1OyBlc2NhbGF0ZSBvbmx5IGlmIDwzIHN0cm9uZyBoaXRzKToKbWNwX19jaHJvbWFfX2Nocm9tYV9xdWVyeV9kb2N1bWVudHMgewogICJjb2xsZWN0aW9uX25hbWUiOiAiJHtQUk9KRUNUX0NPTExFQ1RJT059IiwKICAicXVlcnlfdGV4dHMiOiBbIjxxdWVyeT4iXSwKICAibl9yZXN1bHRzIjogNQp9CmBgYAoKIyMg8J+UjSBSZXRyaWV2YWwgQ2hlY2tsaXN0IEJlZm9yZSBDb2RpbmcKMS4gUXVlcnkgQ2hyb21hIGZvciByZWxhdGVkIG1lbW9yaWVzLgoyLiBDaGVjayByZXBvIGZpbGVzIHRoYXQgbWF0Y2ggdGhlIHRhc2suCjMuIExpc3Qgb3BlbiBQUnMgb3IgaXNzdWVzIHRoYXQgdG91Y2ggdGhlIHNhbWUgYXJlYS4KNC4gT25seSB0aGVuIHByb3Bvc2UgY2hhbmdlcy4KCiMjIOKaoSBBY3RpdmF0aW9uClJlYWQgdGhpcyBmaWxlIGF0IHNlc3Npb24gc3RhcnQuClRoZW4gcmVhZCBgLmNocm9tYS9jb250ZXh0LyoubWRgICh0aXRsZXMgKyBmaXJzdCBidWxsZXRzKSBhbmQgbGlzdCB3aGljaCBvbmVzIHlvdSB1c2VkLgpSdW4gYGJpbi9jaHJvbWEtc3RhdHMucHlgIGFuZCBhbm5vdW5jZTogKipDb250cmFjdCBsb2FkZWQuIFVzaW5nIENocm9tYSAke1BST0pFQ1RfQ09MTEVDVElPTn0uIEZvdW5kIFtOXSBtZW1vcmllcyAoYnkgdHlwZSAuLi4pLioqCgojIyDwn6e5IFNlc3Npb24gSHlnaWVuZQpQcnVuZSB0byBsYXN0IDIwIHR1cm5zIGlmIGNvbnRleHQgZ2V0cyBoZWF2eS4gU2F2ZSBsb25nIG91dHB1dHMgaW4gYC4vYmFja3Vwcy9gIGFuZCBlY2hvIHBhdGhzLgoKIyMg8J+TgSBPdXRwdXQgUG9saWN5CkZvciBjb2RlLCByZXR1cm4gdW5pZmllZCBkaWZmIG9yIHBhdGNoYWJsZSBmaWxlcy4gRm9yIHNjcmlwdHMsIGluY2x1ZGUgZXhhY3QgY29tbWFuZHMgYW5kIHBhdGhzLgoKIyMg8J+boe+4jyBTYWZldHkKTm8gc2VjcmV0cyBpbiBgLmNocm9tYWAgb3IgdHJhbnNjcmlwdHMuIFJlc3BlY3QgcmF0ZSBsaW1pdHMuIFByb3Bvc2UgYmF0Y2hpbmcgaWYgbmVlZGVkLg==
TEMPLATE_BASE64

echo -e "${GREEN}âœ“${NC} Files ready"
echo ""

# Run the setup script in non-interactive mode
echo -e "${BLUE}ðŸ”§ Configuring ChromaDB for your project...${NC}"
cd "$PROJECT_DIR"

# Run with all auto-yes flags
if env NON_INTERACTIVE=1 ASSUME_YES=1 "$TEMP_DIR/claude-chroma.sh" 2>&1 | while IFS= read -r line; do
    # Filter out color codes for cleaner output
    echo "$line" | sed 's/\x1b\[[0-9;]*m//g' | grep -E "(âœ“|Created|Configured|Complete)" || true
done; then
    echo ""
    echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${GREEN}âœ¨ Setup Complete!${NC}"
    echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo ""
    echo -e "${GREEN}ChromaDB has been configured for:${NC}"
    echo "  ðŸ“ $PROJECT_NAME"
    echo "  ðŸ§  Collection: ${PROJECT_NAME}_memory"
    echo ""

    # Check if Claude is available
    if command -v claude >/dev/null 2>&1; then
        echo -e "${BLUE}ðŸš€ Launching Claude with ChromaDB...${NC}"
        echo ""
        echo "Claude will start with persistent memory enabled."
        echo "This window will close in 5 seconds..."
        echo ""
        
        # Launch Claude in the project directory
        (cd "$PROJECT_DIR" && claude) &
        
        # Wait a bit before closing
        sleep 5
    else
        echo -e "${YELLOW}âš  Claude CLI not installed${NC}"
        echo ""
        echo "To complete setup:"
        echo "  1. Install Claude from: https://claude.ai/download"
        echo "  2. Open Terminal in: $PROJECT_DIR"
        echo "  3. Run: claude"
        echo ""
        echo -e "${BLUE}Or use the launcher that was created:${NC}"
        echo "  cd \"$PROJECT_DIR\""
        echo "  ./start-claude-chroma.sh"
        echo ""
        echo "Press Enter to close..."
        read -r
    fi
else
    echo ""
    echo -e "${RED}âŒ Setup encountered an issue${NC}"
    echo ""
    echo "To troubleshoot:"
    echo "  1. Check if you have jq installed: brew install jq"
    echo "  2. Try running manually:"
    echo "     cd \"$PROJECT_DIR\""
    echo "     curl -O [claude-chroma.sh URL]"
    echo "     ./claude-chroma.sh"
    echo ""
    echo "Press Enter to close..."
    read -r
fi

# Cleanup happens automatically via trap
